(function(){angular.module("maestrano.transac",["transac.components","transac.common"]).config(["$httpProvider",function(n){return n.defaults.headers.common.Accept="application/json",n.defaults.headers.common["Content-Type"]="application/json"}])}).call(this),function(){angular.module("transac.common",[])}.call(this),function(){angular.module("transac.components",["transac.user","transac.top-bar","transac.transactions"])}.call(this),function(){angular.module("transac.top-bar",[]).constant("MENUS",[{title:"Transactions",type:"pending",active:!0},{title:"History",type:"history",active:!1}]).value("EventEmitter",function(n){return{$event:n}})}.call(this),function(){angular.module("transac.user",[])}.call(this),function(){angular.module("transac.transactions",["transac.user","infinite-scroll"]).value("EventEmitter",function(n){return{$event:n}}).value("THROTTLE_MILLISECONDS",1e3).constant("DEV_AUTH",{apiKey:"",apiSecret:"",orgUid:""})}.call(this),function(){angular.module("maestrano.transac").component("transac",{bindings:{},templateUrl:"transac",controller:["TransacUserService",function(n){var t,a;t=this,t.$onInit=function(){return t.transacReady=!1,t.isTopBarShown=!0,t.pendingTxsCount=0,t.historyTxCount=0,a()},t.onTxsComponentInit=function(n){var a;return a=n.api,t.txsCmpApi=a},t.onTopBarSelectMenu=function(n){var a;return a=n.menu,t.txsCmpApi.reloadTxs(a.type)},t.onTopBarSearch=function(n){var a,e,i;return e=n.query,i=n.selectedMenu,a=e?{$filter:e}:null,t.txsCmpApi.reloadTxs(i.type,a,!0)},t.updateTransactionsCount=function(n){var a,e;return e=n.pendingTxsCount,a=n.historyTxsCount,t.pendingTxsCount=e,t.historyTxsCount=a},t.toggleTopBar=function(n){var a;return a=n.isReconciling,t.isTopBarShown=!a},a=function(){return n.fetch().then(null,function(n){return t.transacLoadError=!0}).finally(function(){return t.transacReady=!0})}}]})}.call(this),function(){angular.module("transac.top-bar").component("transacTopBar",{bindings:{onInitMenu:"&?",onSelectMenu:"&",onSearch:"&",pendingTxsCount:"<"},templateUrl:"components/top-bar",controller:["MENUS","EventEmitter","$compile","$scope",function(n,t,a,e){var i,c,r;c=this,c.$onInit=function(){if(c.isSearchBarShown=!1,c.menus=angular.copy(n),c.selectedMenu=_.find(c.menus,"active"),null!=c.onInitMenu)return c.onInitMenu(t({menu:c.selectedMenu}))},c.onMenuItemClick=function(n){if(!_.isEqual(n,c.selectedMenu))return _.each(c.menus,function(n){n.active=!1}),n.active=!0,c.selectedMenu=n,c.onSelectMenu(t({menu:c.selectedMenu}))},c.getCount=function(n){return n.title&&c[n.type+"TxsCount"]||0},c.toggleSearch=function(n){return c.isEditingSearchBar?c.searchBarApi.clearSearchText():c.isSearchBarShown?i(n):r(n)},c.onSearchBarInit=function(n){var t;return t=n.api,c.searchBarApi=t},c.onSearchBarSubmit=function(n){return n.selectedMenu=c.selectedMenu,c.onSearch(t(n))},c.onSearchBarChange=function(n){var t;return t=n.isEditing,c.isEditingSearchBar=t},r=function(n){var t,i;i='<transac-search-bar\n  on-init="onSearchBarInit($event)"\n  on-submit="onSearchBarSubmit($event)"\n  on-change="onSearchBarChange($event)">\n</transac-search-bar>',t=angular.element(n.currentTarget.parentElement).find(".top-bar_menu"),angular.merge(e,{onSearchBarInit:c.onSearchBarInit,onSearchBarSubmit:c.onSearchBarSubmit,onSearchBarChange:c.onSearchBarChange}),t.append(a(i)(e)),c.isSearchBarShown=!0},i=function(n){var t;t=angular.element(n.currentTarget.parentElement).find("transac-search-bar"),t.addClass("remove-search-bar"),t.on("animationend webkitAnimationEnd oAnimationEnd MSAnimationEnd",function(){return t.remove(),c.isSearchBarShown=!1})}}]})}.call(this),function(){angular.module("transac.user").provider("TransacUserService",function(){var n,t,a;return a=this,t={user:null,organizations:null},a.configure=function(n){return angular.extend(t,n)},n=function(n,a){var e;return e=this,e.user={},e.get=function(){return angular.copy(e.user)},e.getCurrentOrg=function(){return _.isEmpty(e.user)?{}:_.find(e.user.organizations,function(n){return n.id===e.user.currentOrgId})},e.fetch=function(){var i;return i=_.map(t,function(t,a){return null!=t?t():n.reject("transac error: no "+a+" callback configured.")}),n.all(i).then(function(n){return e.user=angular.merge({},n[0],n[1]),e.get()},function(t){return a.error(t),n.reject(t)})},e},n.$inject=["$q","$log"],a.$get=n,a})}.call(this),angular.module("maestrano.transac").run(["$templateCache",function(n){n.put("transac",'<div ng-if="$ctrl.transacReady">\n  <transac-top-bar ng-show="$ctrl.isTopBarShown" on-select-menu="$ctrl.onTopBarSelectMenu($event)" on-search="$ctrl.onTopBarSearch($event)" pending-txs-count="$ctrl.pendingTxsCount" history-txs-count="$ctrl.historyTxsCount"></transac-top-bar>\n\n  <transac-txs on-init="$ctrl.onTxsComponentInit($event)" on-transactions-change="$ctrl.updateTransactionsCount($event)" on-reconciling="$ctrl.toggleTopBar($event)"></transac-txs>\n</div>\n<div ng-if="!$ctrl.transacReady">\n  <p>Loading...</p>\n</div>\n'),n.put("components/top-bar",'<div class="top-bar">\n  <div class="top-bar_menu">\n    <a href="" class="top-bar_menu_tab top-bar_menu_flex-item" ng-class="{ \'active\': menu.active }" ng-click="$ctrl.onMenuItemClick(menu)" ng-repeat="menu in $ctrl.menus track by $index">\n      <h5>{{::menu.title}} ({{$ctrl.getCount(menu)}})</h5>\n    </a>\n    <!-- $compiles transac-search-bar cmp here (see controller) -->\n  </div>\n  <button class="top-bar_toggle-search-btn" ng-click="$ctrl.toggleSearch($event)">\n    <i class="fa fa-2x fa-fw" ng-class="{ \'fa-search\': !$ctrl.isEditingSearchBar, \'fa-times\': $ctrl.isEditingSearchBar }" aria-hidden="true"></i>\n  </button>\n</div>\n'),n.put("components/top-bar/search-bar",'<input type="text" placeholder="Search Transactions..." ng-model="$ctrl.search.text" ng-keypress="$ctrl.submitOnKeypress($event)" ng-change="$ctrl.onSearchChange()">\n'),n.put("components/transactions/transaction",'<div ng-class="{ \'selected\': $ctrl.isSelected }">\n  <div class="summary">\n    <a href="" class="summary_content" ng-click="$ctrl.selectOnClick()">\n      <div class="summary_content_icon">\n        <i class="fa {{$ctrl.icon()}} fa-2x" aria-hidden="true"></i>\n      </div>\n      <div class="summary_content_caption">\n        <div class="summary_content_caption_title">\n          <span>{{::$ctrl.title()}}</span>\n        </div>\n        <div class="summary_content_caption_subtitle">\n          <span>{{::$ctrl.subtitle()}}</span>\n        </div>\n      </div>\n      <div class="summary_content_warning">\n        <div ng-if="$ctrl.hasMatches()">\n          <i class="fa fa-exclamation-triangle fa-lg" aria-hidden="true"></i>\n          <span>This record may be a duplicate</span>\n        </div>\n      </div>\n    </a>\n    <div class="summary_actions">\n      <button type="button" class="summary_actions_action--deny" ng-click="$ctrl.denyOnClick()">\n        <i class="fa fa-times fa-2x"></i>\n      </button>\n      <button type="button" class="summary_actions_action--approve" ng-click="$ctrl.approveOnClick(true)">\n        <i class="fa fa-check fa-2x"></i>\n      </button>\n    </div>\n  </div>\n  <div class="detail" ng-if="$ctrl.isSelected">\n    <div class="row">\n      <div class="col-md-6 detail_section no-gutters">\n        <transac-tx-changes changes="$ctrl.formattedChanges"></transac-tx-changes>\n      </div>\n      <div class="col-md-3 detail_section no-gutters">\n        <div class="detail_section_title">\n          <h5>Select apps to share with:</h5>\n        </div>\n        <div class="detail_section_app" ng-repeat="mapping in ::$ctrl.transaction.mappings" ng-click="$ctrl.selectAppOnClick($event, mapping)">\n          <span>{{::mapping.app_name}}</span>\n          <input type="checkbox" ng-checked="mapping.sharedWith">\n        </div>\n      </div>\n      <div class="col-md-3 detail_section no-gutters">\n        <div class="detail_section_action detail_section_action--approve" ng-click="$ctrl.approveOnClick()">\n          <span>Approve only this time</span>\n          <button type="button">\n            <i class="fa fa-check fa-2x"></i>\n          </button>\n        </div>\n        <div class="detail_section_action detail_section_action--deny" ng-click="$ctrl.denyOnClick(true)">\n          <span>Never share this record</span>\n          <button type="button">\n            <i class="fa fa-ban"></i>\n          </button>\n        </div>\n        <div class="detail_section_action detail_section_action--duplicate" ng-click="$ctrl.reconcileOnClick()" ng-if="$ctrl.hasMatches()">\n          <span>This record is a duplicate</span>\n          <button type="button">\n            <i class="fa fa-link fa-2x"></i>\n          </button>\n        </div>\n      </div>\n    </div>\n    <div ng-if="$ctrl.hasMatches()">\n      <div class="row detail_dup-line-break">\n        <div class="detail_dup-line-break_spacer detail_dup-line-break_spacer--left"></div>\n        <div class="detail_dup-line-break_title">\n          <div>\n            <i class="fa fa-exclamation fa-lg" aria-hidden="true"></i>\n            <span>Potential Duplicates</span>\n          </div>\n        </div>\n        <div class="detail_dup-line-break_spacer detail_dup-line-break_spacer--right"></div>\n      </div>\n      <div class="row">\n        <div class="col-md-12 col-xs-12 detail_section detail_section_matches">\n          <transac-tx-matches matches="::$ctrl.matches"></transac-tx-matches>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n'),n.put("components/transactions/transaction-changes",'<div class="table-responsive">\n  <table class="table table-striped borderless">\n    <tr>\n      <th ng-if="$ctrl.onSelect">Tick</th>\n      <th>Field</th>\n      <th>Value</th>\n    </tr>\n    <tr ng-repeat="(key, value) in ::$ctrl.changes">\n      <td ng-if="$ctrl.onSelect"><input type="checkbox"></td>\n      <td>{{::key}}</td>\n      <td>{{::value}}</td>\n    </tr>\n  </table>\n</div>\n'),n.put("components/transactions/transaction-reconcile",'<div class="top-panel">\n  <button class="top-panel_action-btns" ng-click="$ctrl.back()">\n    <i class="fa fa-angle-double-left fa-2x"></i>\n  </button>\n  <div class="top-panel_title">\n    <span>Reconcile duplicate records</span>\n  </div>\n  <button class="top-panel_action-btns right-align" ng-if="$ctrl.isNextBtnShown()" ng-click="$ctrl.next()">\n    <i class="fa fa-angle-double-right fa-2x"></i>\n  </button>\n  <button class="top-panel_action-btns top-panel_action-btns--done right-align" ng-if="!$ctrl.editing" ng-click="$ctrl.publish()">\n    <i class="fa fa-check fa-2x"></i>\n  </button>\n</div>\n<div class="edit" ng-show="$ctrl.editing">\n  <div class="edit_tx">\n    <transac-tx-tile  ng-repeat="tx in ::$ctrl.transactions track by tx.id" transaction="::tx" checked="$ctrl.isTxChecked(tx)" on-select="$ctrl.onSelect($event)"></transac-tx-tile>\n  </div>\n</div>\n<div class="review" ng-if="!$ctrl.editing">\n  <div class="review_tx">\n    <transac-tx-tile transaction="::$ctrl.selectedTx" title="::$ctrl.selectedTxTitle" subtitle="::$ctrl.selectedTxSubtitle"></transac-tx-tile>\n  </div>\n</div>\n'),n.put("components/transactions/transaction-matches",'<div ng-repeat="match in ::$ctrl.matches" class="match">\n  <div class="match_caption">\n    <div class="match_caption_title">\n      <span>{{::$ctrl.title(match)}}</span>\n    </div>\n    <div class="match_caption_subtitle">\n      <span>{{::$ctrl.subtitle(match)}}</span>\n    </div>\n  </div>\n</div>\n'),n.put("components/transactions/transaction-tile",'<div class="tx-tile">\n  <div class="tx-tile_topbar row no-gutters" ng-class="{\'no-click\': !$ctrl.isOnSelectDefined()}" ng-click="$ctrl.onSelectTx()">\n    <div class="tx-tile_topbar_checkbox" ng-if="$ctrl.isOnSelectDefined()">\n      <input type="checkbox" ng-checked="$ctrl.checked" disabled>\n    </div>\n    <div class="tx-tile_topbar_text">\n      <h5>{{::$ctrl.title}}</h5>\n      <div class="tx-tile_topbar_text_subtitle">\n        <p>{{::$ctrl.subtitle}}</p>\n      </div>\n    </div>\n  </div>\n  <transac-tx-changes changes="::$ctrl.formattedTxAttrs"></transac-tx-changes>\n</div>\n'),n.put("components/transactions/transactions",'<div ng-hide="$ctrl.reconciling" infinite-scroll="$ctrl.loadMore()" infinite-scroll-immediate-check="false" infinite-scroll-disabled="$ctrl.isPaginationDisabled()">\n  <!-- <transac-txs-controls></transac-txs-controls> -->\n  <transac-tx transaction="transaction" ng-repeat="transaction in $ctrl.transactions track by transaction.transaction_log.id" on-commit="$ctrl.onTransactionCommit($event)" on-reconcile="$ctrl.onReconcileTransactions($event)"></transac-tx>\n  <div ng-if="$ctrl.loading" class="loading">\n    <i class="fa fa-spinner fa-spin fa-3x" aria-hidden="true"></i>\n  </div>\n  <div ng-if="!$ctrl.loading" class="manual-load">\n    <div ng-if="($ctrl.txsType == \'pending\')">\n      <button ng-click="$ctrl.loadMore()">{{$ctrl.isPaginationDisabled() ? \'Retry\' : \'Scroll for more\'}}</button>\n    </div>\n    <div ng-if="($ctrl.txsType == \'history\')">\n      <span>Coming Soon</span>\n    </div>\n  </div>\n</div>\n<div ng-if="$ctrl.reconciling">\n  <transac-tx-reconcile transaction="$ctrl.reconcileData.transaction" matches="$ctrl.reconcileData.matches" apps="$ctrl.reconcileData.apps" on-reconciled="$ctrl.onTransactionReconciled($event)"></transac-tx-reconcile>\n</div>\n')}]),function(){angular.module("transac.transactions").service("TransacTxsService",["$log","$http","$q","$window","TransacUserService","DEV_AUTH",function(n,t,a,e,i,c){var r;return r=this,r.HTTP_CONFIG={},this.getHttpConfig=function(){return _.isEmpty(r.HTTP_CONFIG)?c.apiKey&&c.apiSecret?r.HTTP_CONFIG={headers:{Authorization:"Basic "+window.btoa(c.apiKey+":"+c.apiSecret)}}:r.HTTP_CONFIG={params:{sso_session:i.get().sso_session}}:r.HTTP_CONFIG},this.get=function(e,s){var o,l;return null==e&&(e="pending"),null==s&&(s={}),o=c.orgUid||i.getCurrentOrg().uid,l="https://api-connec-sit.maestrano.io/api/v2/"+o+"/transaction_logs/"+e,s=angular.merge({},r.getHttpConfig(),s),t.get(l,s).then(function(n){return{transactions:n.data.transactions,pagination:n.data.pagination}},function(t){return n.error("TransacTxsService Error: ",t),a.reject(t)})},this.commit=function(e,i,c){var s;return null==c&&(c=[]),s={mappings:c},t.put(e,s,r.getHttpConfig()).then(function(n){return{transaction:n.data[i]}},function(t){return n.error("TransacTxsService Error: ",t),a.reject(t)})},this.matches=function(e,i,c){return null==c&&(c={}),c=angular.merge({},r.getHttpConfig(),c),t.get(e,c).then(function(n){return{matches:n.data[i]||[],pagination:n.data.pagination}},function(t){return n.error("TransacTxsService Error: ",t),a.reject(t)})},this.merge=function(e,i,c){return null==c&&(c={}),t.put(e,c,r.getHttpConfig()).then(function(n){return{transaction:n.data[i]}},function(t){return n.error("TransacTxsService Error: ",t),a.reject(t)})},this.formatTitle=function(n){var t,a,e,i;return t=n.transaction_log.action.toLowerCase(),e=n.transaction_log.resource_type,a=_.capitalize(_.words(e).join(" ")),i=function(){switch(e){case"credit_notes":return _.get(n.changes,"transaction_number")+" ("+_.get(n.changes,"type")+")";default:return _.get(n.changes,"name","No name found")}}(),t+" "+a+": "+i},this.formatMatchTitle=function(n){var t,a,e;return a=function(){switch(n.resource_type){case"organizations":return t=_.map(n,function(n,t){if(_.includes(t,["is_"])&&n===!0)return t}),t=_.compact(t)[0],e=t.split("_").slice(-1),e+": "+n.name;default:return _.get(n,"name","No name found")}}()},this.formatAttributes=function(n,t){var a,e;return a=function(){switch(t){case"organizations":return["name","status","address","email","phone","referred_leads","website"];case"tax_codes":return["name","reference","sale_tax_rate","sale_taxes","status","tax_type"];case"accounts":return["name","reference","code","currency","description","status"];default:return[]}}(),e=_.pick(n,a),e=_.isEmpty(e)?n:e,_.each(["updated_at","created_at"],function(t){e[t]=r.formatDisplayDate(_.get(n,t))}),r.flattenObject(e)},this.formatDisplayDate=function(n){return e.moment(n).format("MMM d, Y h:m")},this.flattenObject=function(n,t,a){return null==t&&(t={}),null==a&&(a=null),_.isObject(n)?_.each(n,function(n,e){return r.flattenObject(n,t,(a?a+"_":"")+e)}):t[a]=n,t},this}])}.call(this),function(){angular.module("transac.top-bar").component("transacSearchBar",{bindings:{onSubmit:"&",onChange:"&?",onInit:"&?"},templateUrl:"components/top-bar/search-bar",controller:["EventEmitter","$scope",function(n,t){var a;a=this,a.$onInit=function(){if(a.search={text:""},null!=a.onInit)return a.onInit(n({api:{clearSearchText:a.clearSearchText}}))},a.onSearchChange=function(){if(null!=a.onChange)return a.onChange(n({isEditing:!!a.search.text.length}))},a.submitOnKeypress=function(t,e){var i;if(null==t&&(t={}),null==e&&(e=!1),13===t.keyCode||e)return i=a.search.text?{query:"reference match /"+a.search.text+"/"}:{query:null},a.onSubmit(n(i))},a.clearSearchText=function(){return a.search.text="",a.submitOnKeypress(null,!0),a.onSearchChange()}}]})}.call(this),function(){angular.module("transac.transactions").component("transacTx",{bindings:{transaction:"<",onCommit:"&",onReconcile:"&"},templateUrl:"components/transactions/transaction",controller:["$element","$timeout","EventEmitter","TransacTxsService",function(n,t,a,e){var i;i=this,i.$onInit=function(){return i.formattedChanges=e.formatAttributes(i.transaction.changes,i.transaction.transaction_log.resource_type),_.each(i.transaction.mappings,function(n){return n.sharedWith=!0}),e.matches(i.transaction.links.matches,i.transaction.transaction_log.resource_type).then(function(n){return i.matches=n.matches},function(n){})},i.title=function(){return e.formatTitle(i.transaction)},i.subtitle=function(){var n,t,a,e;return n=i.transaction.transaction_log.action.toLowerCase(),t=_.get(i.formattedChanges,n+"d_at"),a=_.compact(_.map(i.transaction.mappings,function(n){if(!n.pending)return n.app_name})),e=_.compact(_.map(i.transaction.mappings,function(n){if(n.pending)return n.app_name})),t+", from "+a.join(", ")+" to "+e.join(", ")},i.icon=function(){switch(i.transaction.transaction_log.action.toLowerCase()){case"create":return"fa-plus-circle";case"update":return"fa-pencil-square"}},i.hasMatches=function(){return i.matches&&i.matches.length},i.selectOnClick=function(){return i.isSelected=!i.isSelected},i.approveOnClick=function(e){var c;return null==e&&(e=!1),c=n,c.addClass("deleting"),_.each(i.transaction.mappings,function(n){n.commit=n.sharedWith,n.auto_commit=e}),i.onCommit(a({transaction:i.transaction})).then(function(n){return t(function(){if(!n.success)return c.removeClass("deleting")},300)})},i.denyOnClick=function(e){var c;return null==e&&(e=!1),c=n,c.addClass("deleting"),_.each(i.transaction.mappings,function(n){n.commit=!n.sharedWith,n.push_disabled=e}),i.onCommit(a({transaction:i.transaction})).then(function(n){return t(function(){if(!n.success)return c.removeClass("deleting")},300)})},i.reconcileOnClick=function(){var n;if(i.hasMatches())return n=angular.merge({},i.transaction.transaction_log,i.transaction.changes),i.onReconcile(a({transaction:n,matches:i.matches,apps:_.map(i.transaction.mappings,function(n){return n.app_name})}))},i.selectAppOnClick=function(n,t){return t.sharedWith=!t.sharedWith}}]})}.call(this),function(){angular.module("transac.transactions").component("transacTxChanges",{bindings:{changes:"<",onSelect:"&?"},templateUrl:"components/transactions/transaction-changes",controller:["EventEmitter",function(n){var t;t=this,t.$onInit=function(){}}]})}.call(this),function(){angular.module("transac.transactions").component("transacTxReconcile",{bindings:{transaction:"<",matches:"<",apps:"<",onReconciled:"&"},templateUrl:"components/transactions/transaction-reconcile",controller:["EventEmitter",function(n){var t;t=this,t.$onInit=function(){return t.editing=!0,t.transactions=[].concat(t.transaction,t.matches),t.selectedTx={},t.txsSelectionMap={},_.each(_.map(t.transactions,function(n){return n.id}),function(n){t.txsSelectionMap[n]=!1})},t.onSelect=function(n){var a;return a=n.tx,_.each(t.txsSelectionMap,function(n,e){e!==a.id&&(t.txsSelectionMap[e]=!1)}),t.txsSelectionMap[a.id]=!0,t.selectedTx=_.find(t.transactions,function(n){return t.txsSelectionMap[n.id]})},t.isTxChecked=function(n){return t.txsSelectionMap[n.id]},t.isSelectedTxSelected=function(){return!_.isEmpty(t.selectedTx)},t.isNextBtnShown=function(){return t.editing&&t.isSelectedTxSelected()},t.next=function(){if(t.isNextBtnShown())return t.selectedTxTitle="Reconciled Record",t.selectedTxSubtitle="will be updated in "+t.apps.join(", "),t.editing=!1},t.publish=function(){return t.onReconciled(n({txId:t.transaction.id,mergeParams:{ids:_.map(t.matches,function(n){return n.id})}}))},t.back=function(){return t.editing?t.onReconciled(n(null)):t.editing=!0}}]})}.call(this),function(){angular.module("transac.transactions").component("transacTxMatches",{bindings:{matches:"<"},templateUrl:"components/transactions/transaction-matches",controller:["EventEmitter","TransacTxsService",function(n,t){var a;a=this,a.$onInit=function(){},a.title=function(n){return t.formatMatchTitle(n)},a.subtitle=function(n){var a,e,i;return i=n.transaction_logs[0],a=_.get(i,"app_name"),e=t.formatDisplayDate(_.get(i,"created_at")),a?e+", from "+a:e}}]})}.call(this),function(){angular.module("transac.transactions").component("transacTxTile",{bindings:{transaction:"<",title:"<?",subtitle:"<?",checked:"<?",onSelect:"&?"},templateUrl:"components/transactions/transaction-tile",controller:["EventEmitter","TransacTxsService",function(n,t){var a;a=this,a.$onInit=function(){return a.title||(a.title="Transaction"),a.subtitle||(a.subtitle=a.buildSubtitle()),a.formattedTxAttrs=t.formatAttributes(a.transaction,a.transaction.resource_type)},a.buildSubtitle=function(){var n;return a.transaction.app_name?"From "+a.transaction.app_name:(n=a.transaction.transaction_logs,_.isEmpty(n)?"":"From "+n[0].app_name)},a.isOnSelectDefined=function(){return!_.isUndefined(a.onSelect)},a.onSelectTx=function(){if(a.isOnSelectDefined())return a.onSelect(n({tx:a.transaction}))},a.onSelectTxField=function(){}}]})}.call(this),function(){angular.module("transac.transactions").component("transacTxs",{bindings:{txsType:"<?",onInit:"&?",onTransactionsChange:"&?",onReconciling:"&?"},templateUrl:"components/transactions/transactions",controller:["$q","EventEmitter","TransacTxsService",function(n,t,a){var e,i,c;e=this,e.$onInit=function(){if(e.transactions=[],e.txsType||(e.txsType="pending"),e.reconciling=!1,e.pagination={limit:10,page:1,total:0},e.pagination.defaultParams={$skip:0,$top:e.pagination.limit},e.cacheParams=null,i(),null!=e.onInit)return e.api={reloadTxs:e.reload},e.onInit(t({api:e.api}))},e.loadMore=function(){var n,t;return e.isPaginationDisabled()?i(e.cacheParams):(e.pagination.page+=1,n=(e.pagination.page-1)*e.pagination.limit,t={$skip:n,$top:e.pagination.limit},e.cachedParams&&angular.merge(t,e.cachedParams),i(t))},e.reload=function(n,t,a){return null==n&&(n=e.txsType),null==t&&(t=null),null==a&&(a=!1),e.txsType=n,e.cachedParams=a?t:null,e.transactions.length=0,e.pagination.page=1,i(t,n)},e.isPaginationDisabled=function(){return e.loading||e.pagination.total<=0},e.onTransactionCommit=function(t){var i;return i=t.transaction,a.commit(i.links.commit,i.transaction_log.resource_type,i.mappings).then(function(t){return e.transactions=_.reject(e.transactions,function(n){return n.transaction_log.id===i.transaction_log.id}),c(e.pagination.total-=1),n.when({success:!0})},function(t){return n.when({success:!1})})},e.onReconcileTransactions=function(n){var a,i,c;if(c=n.transaction,i=n.matches,a=n.apps,e.reconcileData={transaction:c,matches:i,apps:a},e.reconciling=!0,e.onReconciling)return e.onReconciling(t({isReconciling:!0}))},e.onTransactionReconciled=function(n){var i;if(e.reconcileData=null,e.reconciling=!1,e.onReconciling&&e.onReconciling(t({isReconciling:!1})),null!=n&&(i=_.find(e.transactions,function(t){return t.transaction_log.id===n.txId}),null!=i))return a.merge(i.links.merge,i.transaction_log.resource_type,n.mergeParams).then(function(n){return e.transactions=_.reject(e.transactions,function(n){return n.transaction_log.id===i.transaction_log.id}),c(e.pagination.total-=1)},function(n){})},i=function(n,t){return null==n&&(n=null),null==t&&(t=e.txsType),e.loading=!0,n||(n=e.cachedParams||e.pagination.defaultParams),a.get(t,{params:n}).then(function(n){return e.transactions=e.transactions.concat(n.transactions),e.pagination.total=n.pagination.total,e.cacheParams=null,c()},function(n){return e.pagination.total=0}).finally(function(){return e.loading=!1})},c=function(n){var a;if(null==n&&(n=e.pagination.total),!_.isUndefined(e.onTransactionsChange))return e.onTransactionsChange(t((a={},a[e.txsType+"TxsCount"]=n,a)))}}]})}.call(this);