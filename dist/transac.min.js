(function(){angular.module("maestrano.transac",["transac.components","transac.common"]).config(["$httpProvider",function(n){return n.defaults.headers.common.Accept="application/json",n.defaults.headers.common["Content-Type"]="application/json"}])}).call(this),function(){angular.module("transac.common",[])}.call(this),function(){angular.module("transac.components",["transac.user","transac.top-bar","transac.transactions"])}.call(this),function(){angular.module("transac.top-bar",[]).constant("MENUS",[{title:"Transactions",type:"pending",active:!0},{title:"History",type:"history",active:!1}]).value("EventEmitter",function(n){return{$event:n}})}.call(this),function(){angular.module("transac.user",[])}.call(this),function(){angular.module("transac.transactions",["transac.user","infinite-scroll"]).value("EventEmitter",function(n){return{$event:n}}).value("THROTTLE_MILLISECONDS",1e3).constant("DEV_AUTH",{apiKey:"",apiSecret:"",orgUid:""})}.call(this),function(){angular.module("maestrano.transac").component("transac",{bindings:{},templateUrl:"transac",controller:["TransacUserService","TransacTxsDispatcher",function(n,t){var e,a;e=this,e.$onInit=function(){return e.transacReady=!1,e.isTopBarShown=!0,e.pendingTxsCount=0,e.historyTxCount=0,a()},e.onTxsCmpInit=function(n){var t;return t=n.api,e.txsCmpApi=t},e.onTopBarSelectMenu=function(n){var e;return e=n.menu,t.reloadTxs(e.type)},e.onTopBarSearch=function(n){var t,a,i;return a=n.query,i=n.selectedMenu,t=a?{$filter:a}:null,e.txsCmpApi.searchTxs(i.type,t,!0)},e.updateTransactionsCount=function(n){var t,a;return a=n.pendingTxsCount,t=n.historyTxsCount,e.pendingTxsCount=a,e.historyTxsCount=t},e.toggleTopBar=function(n){var t;return t=n.isReconciling,e.isTopBarShown=!t},e.updateTxsLoadingStatus=function(n){var t;return t=n.loading,e.isTxsLoading=t},a=function(){return n.fetch().then(null,function(n){return e.transacLoadError=!0}).finally(function(){return e.transacReady=!0})}}]})}.call(this),function(){angular.module("transac.top-bar").component("transacTopBar",{bindings:{onInitMenu:"&?",onSelectMenu:"&",onSearch:"&",pendingTxsCount:"<",isMenuLoading:"<?"},templateUrl:"components/top-bar",controller:["MENUS","EventEmitter","$compile","$scope",function(n,t,e,a){var i,c,r;c=this,c.$onInit=function(){if(c.isSearchBarShown=!1,c.menus=angular.copy(n),c.selectedMenu=_.find(c.menus,"active"),null!=c.onInitMenu)return c.onInitMenu(t({menu:c.selectedMenu}))},c.onMenuItemClick=function(n){if(!c.isMenuLoading&&!_.isEqual(n,c.selectedMenu))return _.each(c.menus,function(n){n.active=!1}),n.active=!0,c.selectedMenu=n,c.onSelectMenu(t({menu:c.selectedMenu}))},c.getCount=function(n){return n.title&&c[n.type+"TxsCount"]||0},c.toggleSearch=function(n){return c.isEditingSearchBar?c.searchBarApi.clearSearchText():c.isSearchBarShown?i(n):r(n)},c.onSearchBarInit=function(n){var t;return t=n.api,c.searchBarApi=t},c.onSearchBarSubmit=function(n){return n.selectedMenu=c.selectedMenu,c.onSearch(t(n))},c.onSearchBarChange=function(n){var t;return t=n.isEditing,c.isEditingSearchBar=t},r=function(n){var t,i;i='<transac-search-bar\n  on-init="onSearchBarInit($event)"\n  on-submit="onSearchBarSubmit($event)"\n  on-change="onSearchBarChange($event)">\n</transac-search-bar>',t=angular.element(n.currentTarget.parentElement).find(".top-bar_menu"),angular.merge(a,{onSearchBarInit:c.onSearchBarInit,onSearchBarSubmit:c.onSearchBarSubmit,onSearchBarChange:c.onSearchBarChange}),t.append(e(i)(a)),c.isSearchBarShown=!0},i=function(n){var t;t=angular.element(n.currentTarget.parentElement).find("transac-search-bar"),t.addClass("remove-search-bar"),t.on("animationend webkitAnimationEnd oAnimationEnd MSAnimationEnd",function(){return t.remove(),c.isSearchBarShown=!1})}}]})}.call(this),angular.module("maestrano.transac").run(["$templateCache",function(n){n.put("transac",'<div ng-if="$ctrl.transacReady">\n  <transac-top-bar ng-show="$ctrl.isTopBarShown" is-menu-loading="$ctrl.isTxsLoading" on-select-menu="$ctrl.onTopBarSelectMenu($event)" on-search="$ctrl.onTopBarSearch($event)" pending-txs-count="$ctrl.pendingTxsCount" history-txs-count="$ctrl.historyTxsCount"></transac-top-bar>\n\n  <transac-txs on-init="$ctrl.onTxsCmpInit($event)" on-transactions-change="$ctrl.updateTransactionsCount($event)" on-reconciling="$ctrl.toggleTopBar($event)" on-loading-change="$ctrl.updateTxsLoadingStatus($event)"></transac-txs>\n</div>\n<div ng-if="!$ctrl.transacReady">\n  <p>Loading...</p>\n</div>\n'),n.put("components/top-bar",'<div class="top-bar">\n  <div class="top-bar_menu">\n    <a href="" class="top-bar_menu_tab top-bar_menu_flex-item" ng-class="{ \'active\': menu.active, \'loading\': $ctrl.isMenuLoading }" ng-click="$ctrl.onMenuItemClick(menu)" ng-repeat="menu in $ctrl.menus track by $index">\n      <h5>{{::menu.title}} ({{$ctrl.getCount(menu)}})</h5>\n      <div class="top-bar_menu_tab-line"></div>\n    </a>\n    <!-- $compiles transac-search-bar cmp here (see controller) -->\n  </div>\n  <button class="top-bar_toggle-search-btn" ng-click="$ctrl.toggleSearch($event)">\n    <i class="fa fa-2x fa-fw" ng-class="{ \'fa-search\': !$ctrl.isEditingSearchBar, \'fa-times\': $ctrl.isEditingSearchBar }" aria-hidden="true"></i>\n  </button>\n</div>\n'),n.put("components/top-bar/search-bar",'<input type="text" placeholder="Search Transactions..." ng-model="$ctrl.search.text" ng-keypress="$ctrl.submitOnKeypress($event)" ng-change="$ctrl.onSearchChange()">\n'),n.put("components/transactions/transaction",'<div ng-class="{ \'selected\': $ctrl.isSelected }">\n  <div class="summary">\n    <a href="" class="summary_content" ng-click="$ctrl.selectOnClick()">\n      <div class="summary_content_icon">\n        <i class="fa {{$ctrl.icon()}} fa-2x" aria-hidden="true"></i>\n      </div>\n      <div class="summary_content_caption">\n        <div class="summary_content_caption_title">\n          <span>{{::$ctrl.title()}}</span>\n        </div>\n        <div class="summary_content_caption_subtitle">\n          <span>{{::$ctrl.subtitle()}}</span>\n        </div>\n      </div>\n      <div class="summary_content_warning" ng-if="$ctrl.hasMatches()">\n        <div>\n          <i class="fa fa-exclamation-triangle fa-lg" aria-hidden="true"></i>\n          <span>This record may be a duplicate</span>\n        </div>\n      </div>\n      <div class="summary_actions">\n        <button type="button" class="summary_actions_action--deny" ng-click="$ctrl.denyOnClick()">\n          <i class="fa fa-times fa-2x"></i>\n        </button>\n        <button type="button" class="summary_actions_action--approve" ng-click="$ctrl.approveOnClick(true)">\n          <i class="fa fa-check fa-2x"></i>\n        </button>\n      </div>\n    </a>\n  </div>\n  <div class="detail" ng-if="$ctrl.isSelected">\n    <div class="row">\n      <div class="col-md-6 detail_section no-gutters">\n        <transac-tx-changes changes="$ctrl.formattedChanges"></transac-tx-changes>\n      </div>\n      <div class="col-md-3 detail_section no-gutters">\n        <div class="detail_section_title">\n          <h5>Select apps to share with:</h5>\n        </div>\n        <div class="detail_section_app" ng-repeat="mapping in ::$ctrl.transaction.mappings" ng-click="$ctrl.selectAppOnClick($event, mapping)">\n          <span>{{::mapping.app_name}}</span>\n          <input type="checkbox" ng-checked="mapping.sharedWith">\n        </div>\n      </div>\n      <div class="col-md-3 detail_section no-gutters">\n        <div class="detail_section_action">\n          <div class="detail_section_action_approve" ng-click="$ctrl.approveOnClick()">\n            <span class="action-label">Approve only this time</span>\n            <div class="action-button"><i class="fa fa-check fa-2x"></i></div>\n          </div>\n        </div>\n        <div class="detail_section_action">\n          <div class="detail_section_action_deny" ng-click="$ctrl.denyOnClick(true)">\n            <span class="action-label">Never share this record</span>\n            <div class="action-button"><i class="fa fa-ban fa-2x"></i></div>\n          </div>\n        </div>\n        <div class="detail_section_action" ng-if="$ctrl.hasMatches()">\n          <div class="detail_section_action_duplicate" ng-click="$ctrl.reconcileOnClick()">\n            <span class="action-label">This record is a duplicate</span>\n            <div class="action-button"><i class="fa fa-link fa-2x"></i></div>\n          </div>\n        </div>\n      </div>\n    </div>\n    <div ng-if="$ctrl.hasMatches()">\n      <div class="row detail_dup-line-break">\n        <div class="detail_dup-line-break_spacer detail_dup-line-break_spacer--left"></div>\n        <div class="detail_dup-line-break_title">\n          <div>\n            <i class="fa fa-exclamation fa-lg" aria-hidden="true"></i>\n            <span>Potential Duplicates</span>\n          </div>\n        </div>\n        <div class="detail_dup-line-break_spacer detail_dup-line-break_spacer--right"></div>\n      </div>\n      <div class="row">\n        <div class="col-md-12 col-xs-12 detail_section detail_section_matches">\n          <transac-tx-matches matches="::$ctrl.matches"></transac-tx-matches>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n'),n.put("components/transactions/transaction-changes",'<div class="table-responsive">\n  <table class="table table-striped borderless">\n    <tr>\n      <th ng-if="$ctrl.onSelect">Tick</th>\n      <th>Field</th>\n      <th>Value</th>\n    </tr>\n    <tr ng-repeat="(key, value) in ::$ctrl.changes">\n      <td ng-if="$ctrl.onSelect"><input type="checkbox"></td>\n      <td>{{::key}}</td>\n      <td>{{::value}}</td>\n    </tr>\n  </table>\n</div>\n'),n.put("components/transactions/transaction-matches",'<div ng-repeat="match in ::$ctrl.matches" class="match">\n  <div class="match_caption">\n    <div class="match_caption_title">\n      <span>{{::$ctrl.title(match)}}</span>\n    </div>\n    <div class="match_caption_subtitle">\n      <span>{{::$ctrl.subtitle(match)}}</span>\n    </div>\n  </div>\n</div>\n'),n.put("components/transactions/transaction-reconcile",'<div class="top-panel">\n  <div class="top-panel-btn top-panel_btn--back" ng-click="$ctrl.back()">\n    <div class="action-button"><i class="fa fa-angle-double-left fa-2x"></i></div>\n    <span class="action-label">Back</span>\n  </div>\n  <div class="top-panel_title">\n    <span>Reconcile duplicate records</span>\n  </div>\n  <div class="top-panel-btn top-panel_btn--next top-panel_btn--align-right" ng-if="$ctrl.isNextBtnShown()" ng-click="$ctrl.next()">\n    <span class="action-label">Next</span>\n    <div class="action-button"><i class="fa fa-angle-double-right fa-2x"></i></div>\n  </div>\n  <div class="top-panel-btn top-panel_btn--done top-panel_btn--align-right" ng-if="!$ctrl.editing" ng-click="$ctrl.publish()">\n    <span class="action-label">Publish</span>\n    <div class="action-button"><i class="fa fa-check fa-2x"></i></div>\n  </div>\n</div>\n<div class="edit" ng-show="$ctrl.editing">\n  <div class="edit_tx">\n    <transac-tx-tile  ng-repeat="tx in ::$ctrl.transactions track by tx.id" transaction="::tx" checked="$ctrl.isTxChecked(tx)" deselected="$ctrl.isTxDeselected(tx)" on-select="$ctrl.onSelect($event)"></transac-tx-tile>\n  </div>\n</div>\n<div class="review" ng-if="!$ctrl.editing">\n  <div class="review_tx">\n    <transac-tx-tile transaction="::$ctrl.selectedTx" checked="true" title="::$ctrl.selectedTxTitle" subtitle="::$ctrl.selectedTxSubtitle"></transac-tx-tile>\n  </div>\n</div>\n'),n.put("components/transactions/transaction-tile",'<div class="tx-tile" ng-class="{ \'deselected\': $ctrl.deselected, \'selected\': $ctrl.checked }">\n  <div class="tx-tile_topbar row no-gutters" ng-class="{\'no-click\': !$ctrl.isOnSelectDefined()}" ng-click="$ctrl.onSelectTx()">\n    <div class="tx-tile_topbar_checkbox" ng-if="$ctrl.isOnSelectDefined()">\n      <input type="checkbox" ng-checked="$ctrl.checked" disabled>\n    </div>\n    <div class="tx-tile_topbar_text">\n      <h5>{{::$ctrl.title}}</h5>\n      <div class="tx-tile_topbar_text_subtitle">\n        <p>{{::$ctrl.subtitle}}</p>\n      </div>\n    </div>\n  </div>\n  <transac-tx-changes changes="::$ctrl.formattedTxAttrs"></transac-tx-changes>\n</div>\n'),n.put("components/transactions/transactions",'<div ng-hide="$ctrl.reconciling" infinite-scroll="$ctrl.loadMore()" infinite-scroll-immediate-check="false" infinite-scroll-disabled="$ctrl.isPaginationDisabled()">\n  <!-- <transac-txs-controls></transac-txs-controls> -->\n  <transac-tx transaction="transaction" ng-repeat="transaction in $ctrl.transactions track by transaction.transaction_log.id" on-commit="$ctrl.onTransactionCommit($event)" on-reconcile="$ctrl.onReconcileTransactions($event)"></transac-tx>\n  <div ng-if="$ctrl.loading" class="loading">\n    <i class="fa fa-spinner fa-spin fa-3x" aria-hidden="true"></i>\n  </div>\n  <div ng-if="!$ctrl.loading" class="manual-load">\n    <div ng-if="($ctrl.txsType == \'pending\')">\n      <button ng-click="$ctrl.loadMore()" ng-if="!$ctrl.isPaginationDisabled()">Scroll for more</button>\n      <p ng-if="$ctrl.allTxsFound()">All results</p>\n      <p ng-if="$ctrl.noTxsFound()">No results</p>\n    </div>\n    <div ng-if="($ctrl.txsType == \'history\')">\n      <span>Coming Soon</span>\n    </div>\n  </div>\n</div>\n<div ng-if="$ctrl.reconciling">\n  <transac-tx-reconcile transaction="$ctrl.reconcileData.transaction" matches="$ctrl.reconcileData.matches" apps="$ctrl.reconcileData.apps" on-reconciled="$ctrl.onTransactionReconciled($event)"></transac-tx-reconcile>\n</div>\n')}]),function(){angular.module("transac.user").provider("TransacUserService",function(){var n,t,e;return e=this,t={user:null,organizations:null},e.configure=function(n){return angular.extend(t,n)},n=function(n,e){var a;return a=this,a.user={},a.get=function(){return angular.copy(a.user)},a.getCurrentOrg=function(){return _.isEmpty(a.user)?{}:_.find(a.user.organizations,function(n){return n.id===a.user.currentOrgId})},a.fetch=function(){var i;return i=_.map(t,function(t,e){return null!=t?t():n.reject("transac error: no "+e+" callback configured.")}),n.all(i).then(function(n){return a.user=angular.merge({},n[0],n[1]),a.get()},function(t){return e.error(t),n.reject(t)})},a},n.$inject=["$q","$log"],e.$get=n,e})}.call(this),function(){angular.module("transac.transactions").service("TransacTxsDispatcher",["$q","$timeout","TransacTxsStore","TransacTxsService",function(n,t,e,a){var i;return i=this,this.loadTxs=function(t){var i,c;return null==t&&(t={}),e.getState().loading||e.dispatch("loadingTxs",!0),t.type&&e.dispatch("setTxsType",t.type),t.excludeParams||(i=e.getState().pagination,c={$skip:i.skip,$top:i.top},t.params=angular.merge({},c,t.params)),a.get(t).then(function(t){return e.dispatch("addTxs",t.transactions),e.dispatch("setPgn",t.pagination),n.when({success:!0})},function(t){return n.reject({message:"Load transactions failed"})}).finally(function(){return e.dispatch("loadingTxs",!1)})},this.paginateTxs=function(n){return e.dispatch("loadingTxs",!0),i.loadTxs({url:n,excludeParams:!0})},this.reloadTxs=function(n,t){return null==t&&(t=null),e.dispatch("loadingTxs",!0),e.dispatch("removeAllTxs"),e.dispatch("resetPgnSkip"),i.loadTxs({type:n,params:t})},this.commitTx=function(i,c,r){var s;return s=n.defer(),e.dispatch("minusPgnTotal",1),t(function(){return s.notify(!0)},0),a.commit(i,c,r).then(function(n){return e.dispatch("removeTx",n.transaction.id),s.resolve({success:!0})},function(n){return e.dispatch("plusPgnTotal",1),t(function(){return s.notify(!0)},0),s.reject({message:"Commit transaction failed"})}),s.promise},this.mergeTxs=function(t){var i,c;return i=n.defer(),null==t?i.reject({message:"Cancelled merge"}):(c=_.find(e.getState().transactions,function(n){return n.transaction_log.id===t.txId}),null==c?null==c&&i.reject({message:"No transaction found - merge failed"}):(e.dispatch("loadingTxs"),a.merge(c.links.merge,c.transaction_log.resource_type,t.mergeParams).then(function(n){return i.resolve({success:!0})},function(n){return i.reject({message:"Merge transaction failed"})}))),i.promise},this}])}.call(this),function(){angular.module("transac.transactions").service("TransacTxsService",["$log","$http","$q","$window","TransacUserService","DEV_AUTH",function(n,t,e,a,i,c){var r;return r=this,r.HTTP_CONFIG={},this.getHttpConfig=function(){return _.isEmpty(r.HTTP_CONFIG)?c.apiKey&&c.apiSecret?r.HTTP_CONFIG={headers:{Authorization:"Basic "+window.btoa(c.apiKey+":"+c.apiSecret)}}:r.HTTP_CONFIG={params:{sso_session:i.get().sso_session}}:r.HTTP_CONFIG},this.get=function(a){var s,o,l,u;return null==a&&(a={}),l=a.type||"pending",s=c.orgUid||i.getCurrentOrg().uid,u=a.url||"https://api-connec-sit.maestrano.io/api/v2/"+s+"/transaction_logs/"+l,o=angular.merge({},r.getHttpConfig(),a),t.get(u,o).then(function(t){return 200!==t.status||null==t.data?(n.error("TransacTxsService Error - no data found: ",t),e.reject(t)):{transactions:t.data.transactions||[],pagination:t.data.pagination||{}}},function(t){return n.error("TransacTxsService Error: ",t),e.reject(t)})},this.commit=function(a,i,c){var s;return null==c&&(c=[]),s={mappings:c},t.put(a,s,r.getHttpConfig()).then(function(n){return{transaction:n.data[i]}},function(t){return n.error("TransacTxsService Error: ",t),e.reject(t)})},this.matches=function(a,i,c){return null==c&&(c={}),c=angular.merge({},r.getHttpConfig(),c),t.get(a,c).then(function(n){return{matches:n.data[i]||[],pagination:n.data.pagination}},function(t){return n.error("TransacTxsService Error: ",t),e.reject(t)})},this.merge=function(a,i,c){return null==c&&(c={}),t.put(a,c,r.getHttpConfig()).then(function(n){return{transaction:n.data[i]}},function(t){return n.error("TransacTxsService Error: ",t),e.reject(t)})},this.formatTitle=function(n){var t,e,a,i;return t=n.transaction_log.action.toLowerCase(),a=n.transaction_log.resource_type,e=_.capitalize(_.words(a).join(" ")),i=function(){switch(a){case"credit_notes":return _.get(n.transaction_log,"reference","No reference found")+" ("+_.get(n.changes,"type","-")+")";case"invoices":return _.get(n.transaction_log,"reference","No reference found")+" ("+_.get(n.changes,"type","-")+")";case"purchase_orders":return _.get(n.transaction_log,"reference","No reference found")+" ("+_.get(n.changes,"type","-")+")";default:return _.get(n.transaction_log,"reference","No reference found")}}(),t+" "+e+": "+i},this.formatMatchTitle=function(n){var t,e,a,i;return e=n.transaction_logs[n.transaction_logs.length-1],a=function(){switch(n.resource_type){case"organizations":return t=_.map(n,function(n,t){if(_.includes(t,["is_"])&&n===!0)return t}),t=_.compact(t)[0],i=t.split("_").slice(-1),i+": "+n.name;case"invoices":return _.get(e,"reference","No reference found")+" ("+_.get(n,"type","-")+")";default:return _.get(e,"reference","No reference found")}}()},this.formatAttributes=function(n,t){var e,a;return null==n&&(n={}),e=function(){switch(t){case"organizations":return{plain:["name","status","address","email","phone","referred_leads","website"],dates:[]};case"tax_codes":return{plain:["name","reference","sale_tax_rate","sale_taxes","status","tax_type"],dates:[]};case"accounts":return{plain:["name","reference","code","currency","description","status"],dates:[]};case"items":return{plain:["code","description","is_inventoried","name","purchase_price","sale_price","status"],dates:[]};case"purchase_orders":return{plain:["amount","lines","status","title","transaction_number","type"],dates:["transaction_date"]};case"invoices":return{plain:["amount","balance","deposit","lines","status","tax_calculation","title","transaction_number","type"],dates:["transaction_date","due_date"]};default:return{plain:[]}}}(),a=["updated_at","created_at"].concat(e.dates),e=_.pick(n,e.plain),e=_.isEmpty(e)?n:e,_.each(a,function(n){e[n]=r.formatDisplayDate(_.get(e,n))}),r.flattenObject(e)},this.formatDisplayDate=function(n){return a.moment(n).format("MMM d, Y h:m")},this.flattenObject=function(n,t,e){return null==t&&(t={}),null==e&&(e=null),_.isObject(n)?_.each(n,function(n,a){return r.flattenObject(n,t,(e?e+"_":"")+a)}):t[e]=n,t},this}])}.call(this),function(){angular.module("transac.transactions").service("TransacTxsStore",["$q",function(n){var t,e,a,i;return t=this,i={txsType:"pending",transactions:[],pagination:{top:20,skip:0,total:0},loading:!1},e={},e.dispatched=n.defer(),this.subscribe=function(){return e.dispatched.promise},this.dispatch=function(n,e){switch(null==e&&(e=null),n){case"setTxsType":i.txsType=e;break;case"addTxs":i.transactions=i.transactions.concat(e);break;case"removeTx":_.remove(i.transactions,function(n){return n.transaction_log.id===e});break;case"removeAllTxs":i.transactions.length=0;break;case"loadingTxs":i.loading=e;break;case"setPgn":angular.merge(i.pagination,e);break;case"resetPgnSkip":i.pagination.skip=0;break;case"minusPgnTotal":i.pagination.total-=e;break;case"plusPgnTotal":i.pagination.total+=e}return a(),t.getState()},this.getState=function(){return i},a=function(){e.dispatched.notify(t.getState())},this}])}.call(this),function(){angular.module("transac.top-bar").component("transacSearchBar",{bindings:{onSubmit:"&",onChange:"&?",onInit:"&?"},templateUrl:"components/top-bar/search-bar",controller:["EventEmitter","$scope",function(n,t){var e;e=this,e.$onInit=function(){if(e.search={text:""},null!=e.onInit)return e.onInit(n({api:{clearSearchText:e.clearSearchText}}))},e.onSearchChange=function(){if(null!=e.onChange)return e.onChange(n({isEditing:!!e.search.text.length}))},e.submitOnKeypress=function(t,a){var i;if(null==t&&(t={}),null==a&&(a=!1),13===t.keyCode||a)return i=e.search.text?{query:"reference match /"+e.search.text+"/"}:{query:null},e.onSubmit(n(i))},e.clearSearchText=function(){return e.search.text="",e.submitOnKeypress(null,!0),e.onSearchChange()}}]})}.call(this),function(){angular.module("transac.transactions").component("transacTx",{bindings:{transaction:"<",onCommit:"&",onReconcile:"&"},templateUrl:"components/transactions/transaction",controller:["$element","$timeout","EventEmitter","TransacTxsService",function(n,t,e,a){var i;i=this,i.$onInit=function(){return i.formattedChanges=a.formatAttributes(i.transaction.changes,i.transaction.transaction_log.resource_type),_.each(i.transaction.mappings,function(n){return n.sharedWith=!0}),a.matches(i.transaction.links.matches,i.transaction.transaction_log.resource_type).then(function(n){return i.matches=n.matches},function(n){})},i.title=function(){return a.formatTitle(i.transaction)},i.subtitle=function(){var n,t,e,a;return n=i.transaction.transaction_log.action.toLowerCase(),t=_.get(i.formattedChanges,n+"d_at"),e=_.compact(_.map(i.transaction.mappings,function(n){if(!n.pending)return n.app_name})),a=_.compact(_.map(i.transaction.mappings,function(n){if(n.pending)return n.app_name})),t+", from "+e.join(", ")+" to "+a.join(", ")},i.icon=function(){switch(i.transaction.transaction_log.action.toLowerCase()){case"create":return"fa-plus-circle";case"update":return"fa-pencil-square"}},i.hasMatches=function(){return i.matches&&i.matches.length},i.selectOnClick=function(){return i.isSelected=!i.isSelected},i.approveOnClick=function(a){return null==a&&(a=!1),n.addClass("commiting"),_.each(i.transaction.mappings,function(n){n.commit=n.sharedWith,n.auto_commit=a}),i.onCommit(e({transaction:i.transaction})).then(function(e){return t(function(){if(!e.success)return n.removeClass("commiting")},300)})},i.denyOnClick=function(a){return null==a&&(a=!1),n.addClass("commiting"),_.each(i.transaction.commitingings,function(n){n.commit=!n.sharedWith,n.push_disabled=a}),i.onCommit(e({transaction:i.transaction})).then(function(e){return t(function(){if(!e.success)return n.removeClass("commiting")},300)})},i.reconcileOnClick=function(){var n;if(i.hasMatches())return n=angular.merge({},i.transaction.transaction_log,i.transaction.changes),i.onReconcile(e({transaction:n,matches:i.matches,apps:_.map(i.transaction.mappings,function(n){return n.app_name})}))},i.selectAppOnClick=function(n,t){return t.sharedWith=!t.sharedWith}}]})}.call(this),function(){angular.module("transac.transactions").component("transacTxChanges",{bindings:{changes:"<",onSelect:"&?"},templateUrl:"components/transactions/transaction-changes",controller:["EventEmitter",function(n){var t;t=this,t.$onInit=function(){}}]})}.call(this),function(){angular.module("transac.transactions").component("transacTxMatches",{bindings:{matches:"<"},templateUrl:"components/transactions/transaction-matches",controller:["EventEmitter","TransacTxsService",function(n,t){var e;e=this,e.$onInit=function(){},e.title=function(n){return t.formatMatchTitle(n)},e.subtitle=function(n){var e,a,i;return i=n.transaction_logs[0],e=_.get(i,"app_name"),a=t.formatDisplayDate(_.get(i,"created_at")),e?a+", from "+e:a}}]})}.call(this),function(){angular.module("transac.transactions").component("transacTxReconcile",{bindings:{transaction:"<",matches:"<",apps:"<",onReconciled:"&"},templateUrl:"components/transactions/transaction-reconcile",controller:["EventEmitter",function(n){var t;t=this,t.$onInit=function(){return t.editing=!0,t.transactions=[].concat(t.transaction,t.matches),t.selectedTx={},t.txsSelectionMap={},_.each(_.map(t.transactions,function(n){return n.id}),function(n){t.txsSelectionMap[n]=!1})},t.onSelect=function(n){var e;return e=n.tx,_.each(t.txsSelectionMap,function(n,a){a!==e.id&&(t.txsSelectionMap[a]=!1)}),t.txsSelectionMap[e.id]=!0,t.selectedTx=_.find(t.transactions,function(n){return t.txsSelectionMap[n.id]})},t.isTxChecked=function(n){return t.txsSelectionMap[n.id]},t.hasSelectedTx=function(){return!_.isEmpty(t.selectedTx)},t.isTxDeselected=function(n){return t.hasSelectedTx()&&!t.isTxChecked(n)},t.isNextBtnShown=function(){return t.editing&&t.hasSelectedTx()},t.next=function(){if(t.isNextBtnShown())return t.selectedTxTitle="Reconciled Record",t.selectedTxSubtitle="will be updated in "+t.apps.join(", "),t.editing=!1},t.publish=function(){return t.onReconciled(n({txId:t.transaction.id,mergeParams:{ids:_.map(t.matches,function(n){return n.id})}}))},t.back=function(){return t.editing?t.onReconciled(n(null)):t.editing=!0}}]})}.call(this),function(){angular.module("transac.transactions").component("transacTxTile",{bindings:{transaction:"<",title:"<?",subtitle:"<?",checked:"<?",deselected:"<?",onSelect:"&?"},templateUrl:"components/transactions/transaction-tile",controller:["EventEmitter","TransacTxsService",function(n,t){var e;e=this,e.$onInit=function(){return e.title||(e.title="Transaction"),e.subtitle||(e.subtitle=e.buildSubtitle()),e.formattedTxAttrs=t.formatAttributes(e.transaction,e.transaction.resource_type)},e.buildSubtitle=function(){var n;return e.transaction.app_name?"From "+e.transaction.app_name:(n=e.transaction.transaction_logs,_.isEmpty(n)?"":"From "+n[0].app_name)},e.isOnSelectDefined=function(){return!_.isUndefined(e.onSelect)},e.onSelectTx=function(){if(e.isOnSelectDefined())return e.onSelect(n({tx:e.transaction}))},e.onSelectTxField=function(){}}]})}.call(this),function(){angular.module("transac.transactions").component("transacTxs",{bindings:{txsType:"<?",onInit:"&?",onTransactionsChange:"&?",onReconciling:"&?",onLoadingChange:"&?"},templateUrl:"components/transactions/transactions",controller:["$q","EventEmitter","TransacTxsDispatcher","TransacTxsStore",function(n,t,e,a){var i,c,r,s;i=this,i.$onInit=function(){return i.reconciling=!1,null!=i.onInit&&i.onInit(t({api:{searchTxs:r}})),c(),e.loadTxs({type:i.txsType}).then(function(){return s()})},i.loadMore=function(){if(!i.isPaginationDisabled())return e.paginateTxs(i.pagination.next)},i.isPaginationDisabled=function(){return i.loading||i.reconciling||i.noTxsFound()||i.allTxsFound()},i.isFilteringTxs=function(){return i.cachedParams&&i.cachedParams.$filter},i.allTxsFound=function(){return!i.loading&&i.transactions.length&&i.transactions.length===i.pagination.total},i.noTxsFound=function(){return!i.loading&&!i.transactions.length&&!i.pagination.total},i.onTransactionCommit=function(t){var a;return a=t.transaction,e.commitTx(a.links.commit,a.transaction_log.resource_type,a.mappings).then(function(t){return n.when({success:t.success})},function(t){return n.when({success:!1,message:t.message})},function(n){return s()})},i.onReconcileTransactions=function(n){var e,a,c;if(c=n.transaction,a=n.matches,e=n.apps,i.reconcileData={transaction:c,matches:a,apps:e},i.reconciling=!0,i.onReconciling)return i.onReconciling(t({isReconciling:!0}))},i.onTransactionReconciled=function(a){return e.mergeTxs(a).then(function(t){return e.reloadTxs(i.type),n.when({success:t.success})},function(t){return n.when({success:!1,message:t.message})}).finally(function(){if(i.reconcileData=null,i.reconciling=!1,i.onReconciling)return i.onReconciling(t({isReconciling:!1}))})},c=function(){return i.txsType=a.getState().txsType,i.transactions=a.getState().transactions,i.pagination=a.getState().pagination,i.cachedParams=a.getState().cachedParams,i.loading=a.getState().loading,a.subscribe().then(null,null,function(n){return i.txsType=n.txsType,i.transactions=n.transactions,i.pagination=n.pagination,i.cachedParams=n.cachedParams,i.loading=n.loading,i.onLoadingChange(t({loading:i.loading}))})},r=function(n,t){return e.reloadTxs(n,t).then(function(){return s()})},s=function(){var n;if(!_.isUndefined(i.onTransactionsChange))return i.onTransactionsChange(t((n={},n[i.txsType+"TxsCount"]=i.pagination.total,n)))}}]})}.call(this);