(function(){angular.module("maestrano.transac",["transac.components","transac.common"]).config(["$httpProvider",function(t){return t.defaults.headers.common.Accept="application/json",t.defaults.headers.common["Content-Type"]="application/json"}])}).call(this),function(){angular.module("transac.components",["transac.user","transac.alerts","transac.top-bar","transac.transactions"])}.call(this),function(){angular.module("transac.common",[])}.call(this),function(){angular.module("transac.alerts",["toastr","ngAnimate"]).config(["toastrConfig",function(t){return angular.merge(t,{timeOut:1500,positionClass:"toast-top-right",preventDuplicates:!1,progressBar:!0})}]).constant("TOASTR_OPTS",{success:{timeOut:800},info:{timeOut:800},error:{timeOut:1500}})}.call(this),function(){angular.module("transac.top-bar",[]).constant("MENUS",[{title:"Transactions",type:"pending",active:!0,itemsCount:0},{title:"History",type:"historical",active:!1,itemsCount:0}]).constant("FILTERS_MENU",[{label:"Ascending",type:"$orderby",attr:"created_at",value:"asc",selected:!0},{label:"Descending",type:"$orderby",attr:"created_at",value:"desc",selected:!1},{divider:!0},{label:"Create",type:"$filter",attr:"action",cmd:"eq",value:"'CREATE'",selected:!1},{label:"Update",type:"$filter",attr:"action",cmd:"eq",value:"'UPDATE'",selected:!1},{divider:!0},{label:"Items",type:"$filter",attr:"entity_type",cmd:"match",value:"/Item/",selected:!1},{label:"Purchase Orders",type:"$filter",attr:"entity_type",cmd:"match",value:"/PurchaseOrder/",selected:!1},{label:"Invoices",type:"$filter",attr:"entity_type",cmd:"match",value:"/Invoice/",selected:!1},{label:"Accounts",type:"$filter",attr:"entity_type",cmd:"match",value:"/Account/",selected:!1},{label:"Organizations",type:"$filter",attr:"entity_type",cmd:"match",value:"/Organization/",selected:!1}]).value("EventEmitter",function(t){return{$event:t}})}.call(this),function(){angular.module("transac.transactions",["transac.user","transac.alerts","infinite-scroll","ngAnimate"]).value("EventEmitter",function(t){return{$event:t}}).constant("TXS_EVENTS",{closeAllTxs:"close-all-txs"}).value("THROTTLE_MILLISECONDS",1e3).constant("DEV_AUTH",{apiKey:"",apiSecret:"",orgUid:""})}.call(this),function(){angular.module("transac.user",[])}.call(this),function(){angular.module("maestrano.transac").component("transac",{bindings:{},templateUrl:"transac",controller:["TransacUserService","TransacTxsDispatcher","TransacAlertsService",function(t,n,e){var a,i;a=this,a.$onInit=function(){return a.transacReady=!1,a.isTopBarShown=!0,a.filters=null,i()},a.onTxsCmpInit=function(t){var n;return n=t.api,a.txsCmpApi=n},a.onTopBarCmpInit=function(t){var n;return n=t.api,a.topBarCmpApi=n},a.onTopBarFilter=function(t){var n,e;return e=t.selectedMenu,n=t.filters,a.filters=n,a.txsCmpApi.filterTxs(e.type,n)},a.onRefreshTxs=function(t){var e;return e=t.type,n.reloadTxs(e)},a.updateTransactionsCount=function(t){return a.topBarCmpApi.updateMenusItemsCount(t)},a.toggleTopBar=function(t){var n;return n=t.isReconciling,a.isTopBarShown=!n},a.updateTxsLoadingStatus=function(t){var n;return n=t.loading,a.isTxsLoading=n},i=function(){return t.fetch().then(null,function(t){return e.send(t.message.type,t.message.text),a.transacLoadError=!0}).finally(function(){return a.transacReady=!0})}}]})}.call(this),function(){angular.module("transac.alerts").service("TransacAlertsService",["toastr","TOASTR_OPTS",function(t,n){return this.send=function(e,a,i,r){return null==i&&(i=null),null==r&&(r={}),r=angular.merge({},n[e],r),t[e](_.capitalize(a),i,r)},this}])}.call(this),function(){angular.module("transac.top-bar").component("transacTopBar",{bindings:{onInit:"&?",onFilter:"&",onRefresh:"&",menusItemsCount:"<?",isMenuLoading:"<?"},templateUrl:"components/top-bar",controller:["$compile","$scope","EventEmitter","TransacTopBarStore","TransacTopBarDispatcher",function(t,n,e,a,i){var r,c,s,o,l;c=this,c.$onInit=function(){if(c.isSearchBarShown=!1,o(),null!=c.onInit)return c.onInit(e({api:{selectedMenu:c.selectedMenu,updateMenusItemsCount:l}}))},c.$onChanges=function(t){if(null!=t.isMenuLoading)return n.isMenuLoading=t.isMenuLoading.currentValue},c.onMenuItemClick=function(t){var n;if(!c.isMenuLoading&&!_.isEqual(t,c.selectedMenu))return n=i.selectMenu(t),c.onFilter(e({selectedMenu:n,filters:c.filters}))},c.toggleSearch=function(t){return c.isEditingSearchBar?c.searchBarApi.clearSearchText():c.isSearchBarShown?r(t):s(t)},c.onRefreshTxsClick=function(){var t,n;if(!c.isMenuLoading)return t=a.getState(),n=t.selectedMenu.type,c.onRefresh(e({type:n})).then(function(){var e;return e=_.find(t.menus,function(t){return t.type===n}),i.selectMenu(e)})},c.onSearchBarInit=function(t){var n;return n=t.api,c.searchBarApi=n},c.onSearchBarSubmit=function(t){var n,a;return n=t.filter,a=i.updateSearchFilter(n),c.onFilter(e({selectedMenu:c.selectedMenu,filters:a}))},c.onSearchBarChange=function(t){var n;return n=t.isEditing,c.isEditingSearchBar=n},c.onFilterSelect=function(t){var n;return n=t.selectedFilter,i.selectFilter(n)},c.onFiltersSubmit=function(){var t;return t=i.applyFilters(),c.onFilter(e({selectedMenu:c.selectedMenu,filters:t}))},o=function(){return c.menus=a.getState().menus,c.filters=a.getState().filters,c.filtersMenu=a.getState().filtersMenu,c.selectedMenu=a.getState().selectedMenu,a.subscribe().then(null,null,function(t){return c.menus=t.menus,c.filters=t.filters,c.filtersMenu=t.filtersMenu,c.selectedMenu=t.selectedMenu})},l=function(t){return i.updateMenusItemsCount(t)},s=function(e){var a,i;i='<transac-search-bar\n  on-init="onSearchBarInit($event)"\n  on-submit="onSearchBarSubmit($event)"\n  on-change="onSearchBarChange($event)"\n  is-disabled="isMenuLoading">\n</transac-search-bar>',a=angular.element(e.currentTarget.parentElement).find(".top-bar_menu"),angular.merge(n,{onSearchBarInit:c.onSearchBarInit,onSearchBarSubmit:c.onSearchBarSubmit,onSearchBarChange:c.onSearchBarChange,isMenuLoading:c.isMenuLoading}),a.append(t(i)(n)),c.isSearchBarShown=!0},r=function(t){var n;n=angular.element(t.currentTarget.parentElement).find("transac-search-bar"),n.addClass("remove-search-bar"),n.on("animationend webkitAnimationEnd oAnimationEnd MSAnimationEnd",function(){return n.remove(),c.isSearchBarShown=!1})}}]})}.call(this),angular.module("maestrano.transac").run(["$templateCache",function(t){t.put("transac",'<div ng-if="$ctrl.transacReady">\n  <transac-top-bar ng-show="$ctrl.isTopBarShown" is-menu-loading="$ctrl.isTxsLoading" on-init="$ctrl.onTopBarCmpInit($event)" on-filter="$ctrl.onTopBarFilter($event)" on-refresh="$ctrl.onRefreshTxs($event)"></transac-top-bar>\n\n  <transac-txs on-init="$ctrl.onTxsCmpInit($event)" filters="$ctrl.filters" on-transactions-change="$ctrl.updateTransactionsCount($event)" on-reconciling="$ctrl.toggleTopBar($event)" on-loading-change="$ctrl.updateTxsLoadingStatus($event)"></transac-txs>\n</div>\n<div ng-if="!$ctrl.transacReady">\n  <p>Loading...</p>\n</div>\n'),t.put("components/top-bar",'<div class="top-bar">\n  <transac-filters-selector filters-menu="$ctrl.filtersMenu" on-select="$ctrl.onFilterSelect($event)" on-submit="$ctrl.onFiltersSubmit($event)" is-disabled="$ctrl.isMenuLoading"></transac-filters-selector>\n  <div class="top-bar_refresh-txs">\n    <div type="button" class="top-bar_refresh-txs_btn" ng-click="$ctrl.onRefreshTxsClick()">\n      <i class="fa fa-refresh fa-2x fa-fw"></i>\n    </div>\n  </div>\n  <div class="top-bar_menu">\n    <a href="" class="top-bar_menu_tab top-bar_menu_flex-item" ng-class="{ \'active\': menu.active, \'loading\': $ctrl.isMenuLoading }" ng-click="$ctrl.onMenuItemClick(menu)" ng-repeat="menu in $ctrl.menus track by $index">\n      <h5>{{::menu.title}} ({{menu.itemsCount}})</h5>\n      <div class="top-bar_menu_tab-line"></div>\n    </a>\n    <!-- $compiles transac-search-bar cmp here (see controller) -->\n  </div>\n  <button class="top-bar_toggle-search-btn" ng-class="{ \'loading\': $ctrl.isMenuLoading }" ng-click="$ctrl.toggleSearch($event)" ng-disabled="$ctrl.isMenuLoading">\n    <i class="fa fa-2x fa-fw" ng-class="{ \'fa-search\': !$ctrl.isEditingSearchBar, \'fa-times\': $ctrl.isEditingSearchBar }" aria-hidden="true"></i>\n  </button>\n</div>\n'),t.put("components/top-bar/filters-selector",'<div class="filters-selector">\n  <div class="btn-group" uib-dropdown on-toggle="$ctrl.toggleSelector(open)" auto-close="outsideClick">\n    <button id="filters-selector_selector-btn" type="button" class="btn btn-primary" ng-class="{ \'disabled\': $ctrl.isDisabled }" ng-click="$ctrl.toggleSelector()" uib-dropdown-toggle>\n      <i class="fa fa-filter fa-2x fa-fw" aria-hidden="true"></i>\n    </button>\n    <ul class="dropdown-menu filters-selector_selector-dropdown" uib-dropdown-menu role="menu" aria-labelledby="filters-selector_selector-btn">\n      <li role="{{!item.divider ? \'menuitem\' : \'\'}}" ng-repeat="item in $ctrl.filtersMenu" ng-class="{ \'divider\': item.divider }">\n        <a href="" ng-if="!$ctrl.divider" ng-class="{ \'selected\': item.selected }" ng-click="$ctrl.selectFilterOnClick(item)">{{item.label}}</a>\n      </li>\n    </ul>\n  </div>\n</div>\n'),t.put("components/top-bar/search-bar",'<input type="text" placeholder="Search transactions..." ng-model="$ctrl.search.text" ng-keypress="$ctrl.submitOnKeypress($event)" ng-change="$ctrl.onSearchChange()">\n'),t.put("components/transactions/transaction",'<div ng-class="{ \'selected\': $ctrl.isSelected }">\n  <div class="summary">\n    <a href="" class="summary_content" ng-click="$ctrl.selectOnClick()">\n      <div class="summary_content_icon">\n        <i class="fa {{$ctrl.icon()}} fa-2x" aria-hidden="true"></i>\n      </div>\n      <div class="summary_content_caption">\n        <div class="summary_content_caption_title">\n          <span>{{::$ctrl.title()}}</span>\n        </div>\n        <div class="summary_content_caption_subtitle">\n          <span>{{::$ctrl.subtitle()}}</span>\n        </div>\n      </div>\n      <div class="summary_content_warning" ng-if="$ctrl.hasMatches()" ng-class="{ \'hide\': $ctrl.isSelected }">\n        <div>\n          <i class="fa fa-exclamation-triangle fa-lg" aria-hidden="true"></i>\n          <span>This record may be a duplicate</span>\n        </div>\n      </div>\n    </a>\n    <div class="summary_actions" ng-class="{ \'hide\': $ctrl.isSelected }">\n      <!-- move to component -->\n      <div type="button" class="tx-icon tx-fab summary_actions_action--deny" ng-click="$ctrl.denyOnClick()" uib-tooltip="Deny only this time" tooltip-popup-delay="300">\n        <i class="fa fa-times fa-2x fa-fw"></i>\n      </div>\n      <div type="button" class="tx-icon tx-fab summary_actions_action--approve" ng-click="$ctrl.approveOnClick(true)" uib-tooltip="Always share this record" tooltip-popup-delay="300">\n        <i class="fa fa-check fa-2x fa-fw"></i>\n      </div>\n    </div>\n  </div>\n  <div class="detail" ng-if="$ctrl.isSelected">\n    <div class="row is-flex">\n\n      <div class="col-md-8 col-xs-12 detail_changes no-gutters">\n        <transac-tx-changes changes="$ctrl.formattedChanges"></transac-tx-changes>\n      </div>\n      <div class="col-md-4 col-xs-12 no-gutters">\n        <div class="row detail_apps no-gutters">\n          <div class="detail_apps_title">\n            <h5>Select apps to share with:</h5>\n          </div>\n          <div class="detail_apps_app" ng-repeat="mapping in ::$ctrl.getPendingMappings()" ng-click="$ctrl.selectAppOnClick($event, mapping)">\n            <span>{{::mapping.app_name}}</span>\n            <input type="checkbox" ng-checked="mapping.sharedWith">\n          </div>\n        </div>\n      </div>\n\n      <!-- <div class="col-md-12 col-xs-12 detail_changes no-gutters">\n        <transac-tx-changes changes="$ctrl.formattedChanges"></transac-tx-changes>\n      </div> -->\n\n    </div>\n    <div class="row" ng-if="$ctrl.hasMatches() && !$ctrl.historical">\n      <div class="col-md-12 col-xs-12">\n        <div class="row detail_dup-line-break">\n          <div class="detail_dup-line-break_spacer detail_dup-line-break_spacer--left"></div>\n          <div class="detail_dup-line-break_title">\n            <div>\n              <i class="fa fa-exclamation fa-lg" aria-hidden="true"></i>\n              <span>Potential Duplicates</span>\n            </div>\n          </div>\n          <div class="detail_dup-line-break_spacer detail_dup-line-break_spacer--right"></div>\n        </div>\n        <div class="row">\n          <div class="col-md-12 col-xs-12 detail_section detail_section_matches">\n            <transac-tx-matches matches="::$ctrl.matches"></transac-tx-matches>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <div class="row details_actions-bar">\n      <div class="detail_actions-bar_wrapper">\n        <div type="button" class="tx-btn tx-raised detail_actions-bar_action--approve" ng-click="$ctrl.approveOnClick(true)" uib-tooltip="Always share this record" tooltip-popup-delay="300">\n          <span>Always share</span>\n          <i class="fa fa-check fa-fw"></i>\n        </div>\n        <div type="button" class="tx-btn tx-raised detail_actions-bar_action--deny-once" ng-click="$ctrl.denyOnClick()" uib-tooltip="Deny only this time" tooltip-popup-delay="300">\n          <span>Do not share</span>\n          <i class="fa fa-times fa-2x fa-fw"></i>\n        </div>\n        <div type="button" class="tx-btn tx-raised detail_actions-bar_action--approve-once" ng-click="$ctrl.approveOnClick()" uib-tooltip="Approve only this time" tooltip-popup-delay="300">\n          <span>Share once</span>\n          <i class="fa fa-check fa-2x"></i><span class="icon-text">x1</span>\n        </div>\n        <div type="button" class="tx-btn tx-raised detail_actions-bar_action--deny" ng-click="$ctrl.denyOnClick(true)" uib-tooltip="Never share this record" tooltip-popup-delay="300">\n          <span>Never share</span>\n          <i class="fa fa-times fa-2x first"/><i class="fa fa-times fa-2x second"/>\n        </div>\n        <div type="button" class="tx-btn tx-raised detail_actions-bar_action--dups" ng-if="$ctrl.hasMatches()" ng-click="$ctrl.reconcileOnClick()" uib-tooltip="Merge duplicate records" tooltip-popup-delay="300">\n          <span>Merge Duplicates</span>\n          <i class="fa fa-link fa-2x fa-fw"></i>\n        </div>\n      </div>\n    </div>\n\n    <!-- <div class="row is-flex"> -->\n\n      <!-- <div class="col-md-6 col-xs-12 no-gutters">\n        <div class="row detail_apps no-gutters">\n          <div class="detail_apps_title">\n            <h5>Select apps to share with:</h5>\n          </div>\n          <div class="detail_apps_app" ng-repeat="mapping in ::$ctrl.transaction.mappings" ng-click="$ctrl.selectAppOnClick($event, mapping)">\n            <span>{{::mapping.app_name}}</span>\n            <input type="checkbox" ng-checked="mapping.sharedWith">\n          </div>\n        </div>\n      </div> -->\n\n      <!-- <div class="col-md-12 col-xs-12 no-gutters detail_actions-bar">\n        <div class="detail_actions-bar_wrapper">\n          <div type="button" class="tx-icon tx-fab detail_actions-bar_action--dups" ng-if="$ctrl.hasMatches()" ng-click="$ctrl.reconcileOnClick()" uib-tooltip="Merge duplicate records" tooltip-popup-delay="300">\n            <i class="fa fa-link fa-2x fa-fw"></i>\n          </div>\n          <div type="button" class="tx-icon tx-fab detail_actions-bar_action--deny" ng-click="$ctrl.denyOnClick(true)" uib-tooltip="Never share this record" tooltip-popup-delay="300">\n            <i class="fa fa-times fa-2x first"/><i class="fa fa-times fa-2x second"/>\n          </div>\n          <div type="button" class="tx-icon tx-fab detail_actions-bar_action--approve-once" ng-click="$ctrl.approveOnClick()" uib-tooltip="Approve only this time" tooltip-popup-delay="300">\n            <i class="fa fa-check fa-2x"></i><span>x1</span>\n          </div>\n          <div type="button" class="tx-icon tx-fab detail_actions-bar_action--deny-once" ng-click="$ctrl.denyOnClick()" uib-tooltip="Deny only this time" tooltip-popup-delay="300">\n            <i class="fa fa-times fa-2x fa-fw"></i>\n          </div>\n          <div type="button" class="tx-icon tx-fab detail_actions-bar_action--approve" ng-click="$ctrl.approveOnClick(true)" uib-tooltip="Always share this record" tooltip-popup-delay="300">\n            <i class="fa fa-check fa-2x fa-fw"></i>\n          </div>\n        </div>\n      </div> -->\n\n    <!-- </div> -->\n\n  </div>\n</div>\n'),t.put("components/transactions/transaction-changes",'<div class="table-responsive">\n  <table class="table table-striped borderless">\n    <tr>\n      <th ng-if="$ctrl.onSelect">Tick</th>\n      <th>Field</th>\n      <th>Value</th>\n    </tr>\n    <tr ng-repeat="(key, value) in ::$ctrl.changes">\n      <td ng-if="$ctrl.onSelect"><input type="checkbox"></td>\n      <td>{{::key}}</td>\n      <td>{{::value}}</td>\n    </tr>\n  </table>\n</div>\n'),t.put("components/transactions/transaction-matches",'<div ng-repeat="match in ::$ctrl.matches" class="match">\n  <div class="match_caption">\n    <div class="match_caption_title">\n      <span>{{::$ctrl.title(match)}}</span>\n    </div>\n    <div class="match_caption_subtitle">\n      <span>{{::$ctrl.subtitle(match)}}</span>\n    </div>\n  </div>\n</div>\n'),t.put("components/transactions/transaction-reconcile",'<div class="top-panel">\n  <div class="top-panel-btn top-panel_btn--back" ng-click="$ctrl.back()">\n    <div class="action-button"><i class="fa fa-angle-double-left fa-2x"></i></div>\n    <span class="action-label">Back</span>\n  </div>\n  <div class="top-panel_title">\n    <span>Reconcile duplicate records</span>\n  </div>\n  <div class="top-panel-btn top-panel_btn--next top-panel_btn--align-right" ng-if="$ctrl.isNextBtnShown()" ng-click="$ctrl.next()">\n    <span class="action-label">Next</span>\n    <div class="action-button"><i class="fa fa-angle-double-right fa-2x"></i></div>\n  </div>\n  <div class="top-panel-btn top-panel_btn--done top-panel_btn--align-right" ng-if="!$ctrl.editing" ng-click="$ctrl.publish()">\n    <span class="action-label">Publish</span>\n    <div class="action-button"><i class="fa fa-check fa-2x"></i></div>\n  </div>\n</div>\n<div class="edit" ng-show="$ctrl.editing">\n  <div class="edit_tx">\n    <transac-tx-tile  ng-repeat="tx in ::$ctrl.transactions track by tx.id" transaction="::tx" checked="$ctrl.isTxChecked(tx)" deselected="$ctrl.isTxDeselected(tx)" on-select="$ctrl.onSelect($event)"></transac-tx-tile>\n  </div>\n</div>\n<div class="review" ng-if="!$ctrl.editing">\n  <div class="review_tx">\n    <transac-tx-tile transaction="::$ctrl.selectedTx" checked="true" title="::$ctrl.selectedTxTitle" subtitle="::$ctrl.selectedTxSubtitle"></transac-tx-tile>\n  </div>\n</div>\n'),t.put("components/transactions/transaction-tile",'<div class="tx-tile" ng-class="{ \'deselected\': $ctrl.deselected, \'selected\': $ctrl.checked }">\n  <div class="tx-tile_topbar row no-gutters" ng-class="{\'no-click\': !$ctrl.isOnSelectDefined()}" ng-click="$ctrl.onSelectTx()">\n    <div class="tx-tile_topbar_checkbox" ng-if="$ctrl.isOnSelectDefined()">\n      <input type="checkbox" ng-checked="$ctrl.checked" disabled>\n    </div>\n    <div class="tx-tile_topbar_text">\n      <h5>{{::$ctrl.title}}</h5>\n      <div class="tx-tile_topbar_text_subtitle">\n        <p>{{::$ctrl.subtitle}}</p>\n      </div>\n    </div>\n  </div>\n  <transac-tx-changes changes="::$ctrl.formattedTxAttrs"></transac-tx-changes>\n</div>\n'),t.put("components/transactions/transactions",'<div ng-hide="$ctrl.reconciling" infinite-scroll="$ctrl.loadMore()" infinite-scroll-immediate-check="false" infinite-scroll-disabled="$ctrl.isPaginationDisabled()">\n  <transac-tx transaction="transaction" ng-repeat="transaction in $ctrl.transactions track by transaction.transaction_log.id" on-commit="$ctrl.onTransactionCommit($event)" on-reconcile="$ctrl.onReconcileTransactions($event)"></transac-tx>\n  <div ng-if="$ctrl.loading" class="loading">\n    <i class="fa fa-spinner fa-spin fa-3x" aria-hidden="true"></i>\n  </div>\n  <div ng-if="!$ctrl.loading" class="manual-load">\n    <div ng-if="($ctrl.txsType == \'pending\')">\n      <button ng-click="$ctrl.loadMore()" ng-if="!$ctrl.isPaginationDisabled()">Scroll for more</button>\n      <p ng-if="$ctrl.allTxsFound()">All results</p>\n      <p ng-if="$ctrl.noTxsFound()">No results</p>\n    </div>\n    <div ng-if="($ctrl.txsType == \'historical\')">\n      <span>Coming Soon</span>\n    </div>\n  </div>\n</div>\n<div ng-if="$ctrl.reconciling">\n  <transac-tx-reconcile transaction="$ctrl.reconcileData.transaction" matches="$ctrl.reconcileData.matches" apps="$ctrl.reconcileData.apps" on-reconciled="$ctrl.onTransactionReconciled($event)"></transac-tx-reconcile>\n</div>\n')}]),function(){angular.module("transac.transactions").service("TransacTopBarDispatcher",["$q","TransacTopBarStore",function(t,n){var e;return e=this,this.selectMenu=function(t){var e;return e=n.dispatch("selectMenu",t),e.selectedMenu},this.updateMenusItemsCount=function(t){return _.each(t,function(t,e){n.dispatch("updateMenuCount",{menuType:e,itemsCount:t})})},this.updateSearchFilter=function(t){var e;return e=n.dispatch("updateSearchFilter",t),e.filters},this.selectFilter=function(t){n.dispatch("selectFilter",t)},this.applyFilters=function(){var t;return t=n.dispatch("applyFilters"),t.filters},this}])}.call(this),function(){angular.module("transac.top-bar").service("TransacTopBarStore",["$q","MENUS","FILTERS_MENU",function(t,n,e){var a,i,r,c,s;return a=this,s={menus:n,selectedMenu:_.find(n,"active"),filtersMenu:e,filters:{},lastSearchQuery:""},r={},r.dispatched=t.defer(),this.subscribe=function(){return r.dispatched.promise},this.dispatch=function(t,n){var e,r,o;switch(null==n&&(n=null),t){case"selectMenu":_.each(s.menus,function(t){t.active=!1}),n.active=!0,s.selectedMenu=n;break;case"updateMenuCount":r=_.find(s.menus,"type",n.menuType),r.itemsCount=n.itemsCount;break;case"updateSearchFilter":s.filters.$filter=i(n);break;case"selectFilter":"$orderby"===n.type?(e=_.filter(s.filtersMenu,"type","$orderby"),_.each(e,function(t){t.selected=!1}),n.selected=!0):n.selected=!n.selected;break;case"applyFilters":o=_.find(_.filter(s.filtersMenu,{type:"$orderby"}),"selected"),s.filters.$orderby=o.attr+" "+o.value,s.filters.$filter=i()}return c(),a.getState()},this.getState=function(){return s},c=function(){r.dispatched.notify(a.getState())},i=function(t){var n,e;return null==t&&(t=[]),e="",n=_.filter(s.filtersMenu,{type:"$filter",selected:!0}).concat(t),_.each(n,function(t,a){e+=t.attr+" "+t.cmd+" "+t.value,a!==n.length-1&&(e+=" AND ")}),e},this}])}.call(this),function(){angular.module("transac.transactions").service("TransacTxsDispatcher",["$q","$timeout","TransacTxsStore","TransacTxsService","TransacAlertsService",function(t,n,e,a,i){var r;return r=this,this.loadTxs=function(n){var r,c;return null==n&&(n={}),e.getState().loading||e.dispatch("loadingTxs",!0),n.type&&e.dispatch("setTxsType",n.type),n.excludeParams||(r=e.getState().pagination,c={$skip:r.skip,$top:r.top},n.params=angular.merge({},c,n.params)),a.get(n).then(function(t){return e.dispatch("addTxs",t.transactions),e.dispatch("setPgn",t.pagination),!0},function(){var n;return n="Failed to load transactions",i.send("error",n,"Error"),t.reject({message:{text:n,type:"error"}})}).finally(function(){return e.dispatch("loadingTxs",!1)})},this.paginateTxs=function(t){return e.dispatch("loadingTxs",!0),r.loadTxs({url:t,excludeParams:!0})},this.reloadTxs=function(t,n){return null==n&&(n=null),e.dispatch("loadingTxs",!0),e.dispatch("removeAllTxs"),e.dispatch("resetPgnSkip"),r.loadTxs({type:t,params:n})},this.commitTx=function(i,r,c){var s;return s=t.defer(),e.dispatch("minusPgnTotal",1),n(function(){return s.notify(!0)},0),a.commit(i,r,c).then(function(t){return e.dispatch("removeTx",t.transaction.id),s.resolve({data:t,message:{text:"Commit transaction success",type:"success"}})},function(){return e.dispatch("plusPgnTotal",1),n(function(){return s.notify(!0)},0),s.reject({message:{text:"Commit transaction failed",type:"error"}})}),s.promise},this.mergeTxs=function(n){var i,r;return i=t.defer(),null==n?i.reject({message:{text:"Merge cancelled",type:"info"}}):(r=_.find(e.getState().transactions,function(t){return t.transaction_log.id===n.txId}),null==r?null==r&&i.reject({message:{text:"No transaction found, merge failed",type:"error"}}):(e.dispatch("loadingTxs"),a.merge(r.links.merge,r.transaction_log.resource_type,n.mergeParams).then(function(t){return i.resolve({message:{text:r.transaction_log.reference+" merged successfully",type:"success"}})},function(){return i.reject({message:{text:r.transaction_log.reference+" failed to merge",type:"error"}})}))),i.promise},this}])}.call(this),function(){angular.module("transac.transactions").service("TransacTxsService",["$log","$http","$q","$window","TransacUserService","DEV_AUTH",function(t,n,e,a,i,r){var c;return c=this,c.HTTP_CONFIG={},this.getHttpConfig=function(){return _.isEmpty(c.HTTP_CONFIG)?r.apiKey&&r.apiSecret?c.HTTP_CONFIG={headers:{Authorization:"Basic "+window.btoa(r.apiKey+":"+r.apiSecret)}}:c.HTTP_CONFIG={params:{sso_session:i.get().sso_session}}:c.HTTP_CONFIG},this.get=function(a){var s,o,l,u,d;return null==a&&(a={}),u=a.type||"pending",s=r.orgUid||i.getCurrentOrg().uid,d=a.url||"https://api-connec-sit.maestrano.io/api/v2/"+s+"/transaction_logs/"+u,o=angular.merge({},c.getHttpConfig(),a),l="pending"===u?n.get(d,o):e.reject(),l.then(function(n){return 200!==n.status||null==n.data?(t.error("TransacTxsService Error - no data found: ",n),e.reject(n)):{transactions:n.data.transactions||[],pagination:n.data.pagination||{}}},function(n){return t.error("TransacTxsService Error: ",n),e.reject(n)})},this.commit=function(a,i,r){var s;return null==r&&(r=[]),s={mappings:r},n.put(a,s,c.getHttpConfig()).then(function(t){return{transaction:t.data[i]}},function(n){return t.error("TransacTxsService Error: ",n),e.reject(n)})},this.matches=function(a,i,r){return null==r&&(r={}),r=angular.merge({},c.getHttpConfig(),r),n.get(a,r).then(function(t){return{matches:t.data[i]||[],pagination:t.data.pagination}},function(n){return t.error("TransacTxsService Error: ",n),e.reject(n)})},this.merge=function(a,i,r){return null==r&&(r={}),n.put(a,r,c.getHttpConfig()).then(function(t){return{transaction:t.data[i]}},function(n){return t.error("TransacTxsService Error: ",n),e.reject(n)})},this.formatTitle=function(t){var n,e,a,i;return n=t.transaction_log.action.toLowerCase(),a=t.transaction_log.resource_type,e=_.capitalize(_.words(a).join(" ")),i=function(){switch(a){case"credit_notes":return _.get(t.transaction_log,"reference","No reference found")+" ("+_.get(t.changes,"type","-")+")";case"invoices":return _.get(t.transaction_log,"reference","No reference found")+" ("+_.get(t.changes,"type","-")+")";case"purchase_orders":return _.get(t.transaction_log,"reference","No reference found")+" ("+_.get(t.changes,"type","-")+")";default:return _.get(t.transaction_log,"reference","No reference found")}}(),n+" "+e+": "+i},this.formatMatchTitle=function(t){var n,e,a,i;return e=t.transaction_logs[t.transaction_logs.length-1],a=function(){switch(t.resource_type){case"organizations":return n=_.map(t,function(t,n){if(_.includes(n,["is_"])&&t===!0)return n}),n=_.compact(n)[0],i=n.split("_").slice(-1),i+": "+t.name;case"invoices":return _.get(e,"reference","No reference found")+" ("+_.get(t,"type","-")+")";default:return _.get(e,"reference","No reference found")}}()},this.formatAttributes=function(t,n){var e,a;return null==t&&(t={}),e=function(){switch(n){case"organizations":return{plain:["name","status","address","email","phone","referred_leads","website"],dates:[]};case"tax_codes":return{plain:["name","reference","sale_tax_rate","sale_taxes","status","tax_type"],dates:[]};case"accounts":return{plain:["name","reference","code","currency","description","status"],dates:[]};case"items":return{plain:["code","description","is_inventoried","name","purchase_price","sale_price","status"],dates:[]};case"purchase_orders":return{plain:["amount","lines","status","title","transaction_number","type"],dates:["transaction_date"]};case"invoices":return{plain:["amount","balance","deposit","lines","status","tax_calculation","title","transaction_number","type"],dates:["transaction_date","due_date"]};default:return{plain:[]}}}(),a=["updated_at","created_at"].concat(e.dates),e=_.pick(t,e.plain),e=_.isEmpty(e)?t:e,_.each(a,function(t){e[t]=c.formatDisplayDate(_.get(e,t))}),c.flattenObject(e)},this.formatDisplayDate=function(t){return a.moment(t).format("MMM d, Y h:m")},this.flattenObject=function(t,n,e){return null==n&&(n={}),null==e&&(e=null),_.isObject(t)?_.each(t,function(t,a){return c.flattenObject(t,n,(e?e+"_":"")+a)}):n[e]=t,n},this}])}.call(this),function(){angular.module("transac.transactions").service("TransacTxsStore",["$q",function(t){var n,e,a,i;return n=this,i={txsType:"pending",transactions:[],pagination:{top:20,skip:0,total:0},loading:!1},e={},e.dispatched=t.defer(),this.subscribe=function(){return e.dispatched.promise},this.dispatch=function(t,e){switch(null==e&&(e=null),t){case"setTxsType":i.txsType=e;break;case"addTxs":i.transactions=i.transactions.concat(e);break;case"removeTx":_.remove(i.transactions,function(t){return t.transaction_log.id===e});break;case"removeAllTxs":i.transactions.length=0;break;case"loadingTxs":i.loading=e;break;case"setPgn":angular.merge(i.pagination,e);break;case"resetPgnSkip":i.pagination.skip=0;break;case"minusPgnTotal":i.pagination.total-=e;break;case"plusPgnTotal":i.pagination.total+=e}return a(),n.getState()},this.getState=function(){return i},a=function(){e.dispatched.notify(n.getState())},this}])}.call(this),function(){angular.module("transac.user").provider("TransacUserService",function(){var t,n,e;return e=this,n={user:null,organizations:null},e.configure=function(t){return angular.extend(n,t)},t=function(t,e){var a;return a=this,a.user={},a.get=function(){return angular.copy(a.user)},a.getCurrentOrg=function(){return _.isEmpty(a.user)?{}:_.find(a.user.organizations,function(t){return t.id===a.user.currentOrgId})},a.fetch=function(){var i;return i=_.map(n,function(n,e){return null!=n?n():t.reject("transac error: no "+e+" callback configured.")}),t.all(i).then(function(t){return a.user=angular.merge({},t[0],t[1]),a.get()},function(n){return e.error(n),t.reject({message:{text:"Failed to load User for Transac!",type:"error"}})})},a},t.$inject=["$q","$log"],e.$get=t,e})}.call(this),function(){angular.module("transac.top-bar").component("transacFiltersSelector",{bindings:{filtersMenu:"<",onSubmit:"&",onSelect:"&",isDisabled:"<?"},templateUrl:"components/top-bar/filters-selector",controller:["EventEmitter",function(t){var n;n=this,n.$onInit=function(){return n.wasSelectionMade=!1},n.toggleSelector=function(e){if(!n.isDisabled&&n.wasSelectionMade&&null!=e)return n.wasSelectionMade=!1,e?void 0:n.onSubmit(t(null))},n.selectFilterOnClick=function(e){return n.wasSelectionMade=!0,n.onSelect(t({selectedFilter:e}))}}]})}.call(this),function(){angular.module("transac.top-bar").component("transacSearchBar",{bindings:{onSubmit:"&",onChange:"&?",onInit:"&?",isDisabled:"<?"},templateUrl:"components/top-bar/search-bar",controller:["EventEmitter","$scope",function(t,n){var e;e=this,e.$onInit=function(){if(e.search={text:""},null!=e.onInit)return e.onInit(t({api:{clearSearchText:e.clearSearchText}}))},e.onSearchChange=function(){if(null!=e.onChange)return e.onChange(t({isEditing:!!e.search.text.length}))},e.submitOnKeypress=function(n,a){var i;if(null==n&&(n={}),null==a&&(a=!1),!e.isDisabled&&(13===n.keyCode||a))return i=e.search.text?{attr:"reference",cmd:"match",value:"/"+e.search.text+"/"}:null,e.onSubmit(t({filter:i}))},e.clearSearchText=function(){return e.search.text="",e.submitOnKeypress(null,!0),e.onSearchChange()}}]})}.call(this),function(){angular.module("transac.transactions").component("transacTx",{bindings:{transaction:"<",onCommit:"&",onReconcile:"&"},templateUrl:"components/transactions/transaction",
controller:["$element","$timeout","$document","$scope","EventEmitter","TransacTxsService","TXS_EVENTS",function(t,n,e,a,i,r,c){var s;s=this,s.$onInit=function(){return s.formattedChanges=r.formatAttributes(s.transaction.changes,s.transaction.transaction_log.resource_type),_.each(s.transaction.mappings,function(t){return t.sharedWith=!0}),r.matches(s.transaction.links.matches,s.transaction.transaction_log.resource_type).then(function(t){return s.matches=t.matches}),a.$on(c.closeAllTxs,function(){return s.isSelected=!1})},s.title=function(){return r.formatTitle(s.transaction)},s.subtitle=function(){var t,n,e,a,i,r;return t=s.transaction.transaction_log.action.toLowerCase(),n=_.get(s.formattedChanges,t+"d_at"),e=_.compact(_.map(s.transaction.mappings,function(t){if(!t.pending)return t.app_name})),i=_.compact(_.map(s.transaction.mappings,function(t){if(t.pending)return t.app_name})),a=""+(_.isEmpty(e)?"":", from "+e.join(", ")),r=""+(!_.isEmpty(i)&&a?" to "+i.join(", "):""),""+n+a+r},s.icon=function(){switch(s.transaction.transaction_log.action.toLowerCase()){case"create":return"fa-plus-circle";case"update":return"fa-pencil-square"}},s.getPendingMappings=function(){return _.select(s.transaction.mappings,{pending:!0})},s.hasMatches=function(){return s.matches&&s.matches.length},s.selectOnClick=function(){if(s.isSelected=!s.isSelected,s.isSelected)return angular.element(e[0].body).animate({scrollTop:t.offset().top})},s.approveOnClick=function(e){return null==e&&(e=!1),t.addClass("commiting"),_.each(s.transaction.mappings,function(t){t.commit=t.sharedWith,t.auto_commit=e}),s.onCommit(i({transaction:s.transaction,action:"approve",auto:e})).then(null,function(e){return n(function(){return t.removeClass("commiting")},300)})},s.denyOnClick=function(e){return null==e&&(e=!1),t.addClass("commiting"),_.each(s.transaction.commitingings,function(t){t.commit=!t.sharedWith,t.push_disabled=e}),s.onCommit(i({transaction:s.transaction,action:"refuse",auto:e})).then(null,function(e){return n(function(){return t.removeClass("commiting")},300)})},s.reconcileOnClick=function(){var n;if(s.hasMatches())return t.addClass("reconciling"),n=angular.merge({},s.transaction.transaction_log,s.transaction.changes),s.onReconcile(i({transaction:n,matches:s.matches,apps:_.map(s.transaction.mappings,function(t){return t.app_name})}))},s.selectAppOnClick=function(t,n){return n.sharedWith=!n.sharedWith}}]})}.call(this),function(){angular.module("transac.transactions").component("transacTxChanges",{bindings:{changes:"<",onSelect:"&?"},templateUrl:"components/transactions/transaction-changes",controller:["EventEmitter",function(t){var n;n=this,n.$onInit=function(){}}]})}.call(this),function(){angular.module("transac.transactions").component("transacTxMatches",{bindings:{matches:"<"},templateUrl:"components/transactions/transaction-matches",controller:["EventEmitter","TransacTxsService",function(t,n){var e;e=this,e.$onInit=function(){},e.title=function(t){return n.formatMatchTitle(t)},e.subtitle=function(t){var e,a,i;return i=t.transaction_logs[0],e=_.get(i,"app_name"),a=n.formatDisplayDate(_.get(i,"created_at")),e?a+", from "+e:a}}]})}.call(this),function(){angular.module("transac.transactions").component("transacTxReconcile",{bindings:{transaction:"<",matches:"<",apps:"<",onReconciled:"&"},templateUrl:"components/transactions/transaction-reconcile",controller:["$window","EventEmitter",function(t,n){var e;e=this,e.$onInit=function(){return t.scrollTo(0,0),e.editing=!0,e.transactions=[].concat(e.transaction,e.matches),e.selectedTx={},e.txsSelectionMap={},_.each(_.map(e.transactions,function(t){return t.id}),function(t){e.txsSelectionMap[t]=!1})},e.onSelect=function(t){var n;return n=t.tx,_.each(e.txsSelectionMap,function(t,a){a!==n.id&&(e.txsSelectionMap[a]=!1)}),e.txsSelectionMap[n.id]=!0,e.selectedTx=_.find(e.transactions,function(t){return e.txsSelectionMap[t.id]})},e.isTxChecked=function(t){return e.txsSelectionMap[t.id]},e.hasSelectedTx=function(){return!_.isEmpty(e.selectedTx)},e.isTxDeselected=function(t){return e.hasSelectedTx()&&!e.isTxChecked(t)},e.isNextBtnShown=function(){return e.editing&&e.hasSelectedTx()},e.next=function(){if(e.isNextBtnShown())return e.selectedTxTitle="Reconciled Record",e.selectedTxSubtitle="will be updated in "+e.apps.join(", "),e.editing=!1},e.publish=function(){return e.onReconciled(n({txId:e.transaction.id,mergeParams:{ids:_.map(e.matches,function(t){return t.id})}}))},e.back=function(){return e.editing?e.onReconciled(n(null)):e.editing=!0}}]})}.call(this),function(){angular.module("transac.transactions").component("transacTxTile",{bindings:{transaction:"<",title:"<?",subtitle:"<?",checked:"<?",deselected:"<?",onSelect:"&?"},templateUrl:"components/transactions/transaction-tile",controller:["EventEmitter","TransacTxsService",function(t,n){var e;e=this,e.$onInit=function(){return e.title||(e.title="Transaction"),e.subtitle||(e.subtitle=e.buildSubtitle()),e.formattedTxAttrs=n.formatAttributes(e.transaction,e.transaction.resource_type)},e.buildSubtitle=function(){var t;return e.transaction.app_name?"From "+e.transaction.app_name:(t=e.transaction.transaction_logs,_.isEmpty(t)?"":"From "+t[0].app_name)},e.isOnSelectDefined=function(){return!_.isUndefined(e.onSelect)},e.onSelectTx=function(){if(e.isOnSelectDefined())return e.onSelect(t({tx:e.transaction}))},e.onSelectTxField=function(){}}]})}.call(this),function(){angular.module("transac.transactions").component("transacTxs",{bindings:{txsType:"<?",filters:"<?",onInit:"&?",onTransactionsChange:"&?",onReconciling:"&?",onLoadingChange:"&?"},templateUrl:"components/transactions/transactions",controller:["$q","$element","$document","$window","$scope","$timeout","EventEmitter","TransacTxsDispatcher","TransacTxsStore","TransacAlertsService","TXS_EVENTS",function(t,n,e,a,i,r,c,s,o,l,u){var d,p,f,g,m;d=this,e[0].addEventListener("keydown",function(t){if(27===t.keyCode)return i.$broadcast(u.closeAllTxs),a.scrollTo(0,0)},!1),d.$onInit=function(){return d.reconciling=!1,null!=d.onInit&&d.onInit(c({api:{filterTxs:f}})),p(),s.loadTxs({type:d.txsType}).then(function(){return g()})},d.loadMore=function(){if(!d.isPaginationDisabled())return s.paginateTxs(d.pagination.next)},d.isPaginationDisabled=function(){return d.loading||d.reconciling||d.noTxsFound()||d.allTxsFound()},d.allTxsFound=function(){return!d.loading&&d.transactions.length&&d.transactions.length===d.pagination.total},d.noTxsFound=function(){return!d.loading&&!d.transactions.length&&!d.pagination.total},d.onTransactionCommit=function(n){var e,a,i;return i=n.transaction,e=n.action,a=n.auto,s.commitTx(i.links.commit,i.transaction_log.resource_type,i.mappings).then(null,function(n){return l.send(n.message.type,"Failed to "+e+" sharing of "+i.transaction_log.reference),t.reject(n)},function(){var t;return t=a?e+"d ongoing sharing for":e+"d sharing for",l.send("success",t+" "+i.transaction_log.reference),g()})},d.onReconcileTransactions=function(t){var n,e,a;if(a=t.transaction,e=t.matches,n=t.apps,d.reconcileData={transaction:a,matches:e,apps:n},d.reconciling=!0,d.onReconciling)return d.onReconciling(c({isReconciling:!0}))},d.onTransactionReconciled=function(n){return s.mergeTxs(n).then(function(t){return l.send(t.message.type,t.message.text),s.reloadTxs(d.txsType,d.filters),t},function(n){return l.send(n.message.type,n.message.text),t.reject(n)}).finally(function(){return d.reconcileData=null,d.reconciling=!1,d.onReconciling&&d.onReconciling(c({isReconciling:!1})),r(function(){return m()},0)})},p=function(){return d.txsType=o.getState().txsType,d.transactions=o.getState().transactions,d.pagination=o.getState().pagination,d.loading=o.getState().loading,o.subscribe().then(null,null,function(t){return d.txsType=t.txsType,d.transactions=t.transactions,d.pagination=t.pagination,d.loading=t.loading,d.onLoadingChange(c({loading:d.loading}))})},f=function(t,n){return s.reloadTxs(t,n).then(function(){return g()})},g=function(){var t;if(!_.isUndefined(d.onTransactionsChange))return d.onTransactionsChange(c((t={},t[""+d.txsType]=d.pagination.total,t)))},m=function(){var t;t=n.find(".reconciling .selected"),null!=t&&(angular.element(e[0].body).animate({scrollTop:t.offset().top}),t.parent().removeClass("reconciling"))}}]})}.call(this);